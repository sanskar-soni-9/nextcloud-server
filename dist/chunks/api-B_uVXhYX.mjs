/*! third party licenses: dist/vendor.LICENSE.txt */
import{c2 as x,cb as f,ca as C,aV as v,bT as o,b_ as E,bS as L}from"../core-common.mjs";import{c as F}from"./index-BxKJ4nfQ.mjs";const N=/[\p{Lu}]/u,R=/[\p{Ll}]/u,m=/^[\p{Lu}](?![\p{Lu}])/gu,A=/([\p{Alpha}\p{N}_]|$)/u,g=/[_.\- ]+/,U=new RegExp("^"+g.source),y=new RegExp(g.source+A.source,"gu"),h=new RegExp("\\d+"+A.source,"gu"),q=(t,s,e,a)=>{let r=!1,l=!1,d=!1,u=!1;for(let n=0;n<t.length;n++){const c=t[n];u=n>2?t[n-3]==="-":!0,r&&N.test(c)?(t=t.slice(0,n)+"-"+t.slice(n),r=!1,d=l,l=!0,n++):l&&d&&R.test(c)&&(!u||a)?(t=t.slice(0,n-1)+"-"+t.slice(n-1),d=l,l=!1,r=!0):(r=s(c)===c&&e(c)!==c,d=l,l=e(c)===c&&s(c)!==c)}return t},O=(t,s)=>(m.lastIndex=0,t.replaceAll(m,e=>s(e))),V=(t,s)=>(y.lastIndex=0,h.lastIndex=0,t.replaceAll(h,(e,a,r)=>["_","-"].includes(t.charAt(r+e.length))?e:s(e)).replaceAll(y,(e,a)=>s(a)));function w(t,s){if(!(typeof t=="string"||Array.isArray(t)))throw new TypeError("Expected the input to be `string | string[]`");if(s={pascalCase:!1,preserveConsecutiveUppercase:!1,...s},Array.isArray(t)?t=t.map(r=>r.trim()).filter(r=>r.length).join("-"):t=t.trim(),t.length===0)return"";const e=s.locale===!1?r=>r.toLowerCase():r=>r.toLocaleLowerCase(s.locale),a=s.locale===!1?r=>r.toUpperCase():r=>r.toLocaleUpperCase(s.locale);return t.length===1?g.test(t)?"":s.pascalCase?a(t):e(t):(t!==e(t)&&(t=q(t,e,a,s.preserveConsecutiveUppercase)),t=t.replace(U,""),t=s.preserveConsecutiveUppercase?O(t,e):e(t),s.pascalCase&&(t=a(t.charAt(0))+t.slice(1)),V(t,a))}const M={userVisible:!0,userAssignable:!0,canAssign:!0},P=t=>t.map(({props:s})=>Object.fromEntries(Object.entries(s).map(([e,a])=>[w(e),w(e)==="displayName"?String(a):a]))),T=t=>{const s=t.indexOf("?");s>0&&(t=t.substring(0,s));const e=t.split("/");let a;do a=e[e.length-1],e.pop();while(!a&&e.length>0);return Number(a)},_=t=>{const s={...t};return s.name&&!s.displayName||(s.name=s.displayName,delete s.displayName),s},j=x("dav"),p=F(j),b=t=>{p.setHeaders({"X-Requested-With":"XMLHttpRequest",requesttoken:t!=null?t:""})};C(b),b(f());const i=v.getLoggerBuilder().setApp("systemtags").detectUser().build(),D='<?xml version="1.0"?>\n<d:propfind  xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns">\n	<d:prop>\n		<oc:id />\n		<oc:display-name />\n		<oc:user-visible />\n		<oc:user-assignable />\n		<oc:can-assign />\n	</d:prop>\n</d:propfind>',S=async()=>{const t="/systemtags";try{const{data:s}=await p.getDirectoryContents(t,{data:D,details:!0,glob:"/systemtags/*"});return P(s)}catch(s){throw i.error(o("systemtags","Failed to load tags"),{error:s}),new Error(o("systemtags","Failed to load tags"))}},X=async()=>{const t=E("/apps/systemtags/lastused");try{const{data:s}=await L.get(t);return s.map(Number)}catch(s){throw i.error(o("systemtags","Failed to load last used tags"),{error:s}),new Error(o("systemtags","Failed to load last used tags"))}},B=async t=>{const s="/systemtags",e=_(t);try{const{headers:a}=await p.customRequest(s,{method:"POST",data:e}),r=a.get("content-location");if(r)return T(r);throw i.error(o("systemtags",'Missing "Content-Location" header')),new Error(o("systemtags",'Missing "Content-Location" header'))}catch(a){throw i.error(o("systemtags","Failed to create tag"),{error:a}),new Error(o("systemtags","Failed to create tag"))}},W=async t=>{const s="/systemtags/"+t.id,e='<?xml version="1.0"?>\n	<d:propertyupdate  xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns">\n		<d:set>\n			<d:prop>\n				<oc:display-name>'.concat(t.displayName,"</oc:display-name>\n				<oc:user-visible>").concat(t.userVisible,"</oc:user-visible>\n				<oc:user-assignable>").concat(t.userAssignable,"</oc:user-assignable>\n			</d:prop>\n		</d:set>\n	</d:propertyupdate>");try{await p.customRequest(s,{method:"PROPPATCH",data:e})}catch(a){throw i.error(o("systemtags","Failed to update tag"),{error:a}),new Error(o("systemtags","Failed to update tag"))}},k=async t=>{const s="/systemtags/"+t.id;try{await p.deleteFile(s)}catch(e){throw i.error(o("systemtags","Failed to delete tag"),{error:e}),new Error(o("systemtags","Failed to delete tag"))}};export{k as a,p as b,B as c,M as d,D as e,S as f,_ as g,X as h,i as l,P as p,W as u};
