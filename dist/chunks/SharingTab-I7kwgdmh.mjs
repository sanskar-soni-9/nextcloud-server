/*! third party licenses: dist/vendor.LICENSE.txt */
var ze=Object.defineProperty;var Ge=(e,s,i)=>s in e?ze(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i;var ye=(e,s,i)=>(Ge(e,typeof s!="symbol"?s+"":s,i),i);import{bX as X,aW as ue,bw as ee,bS as I,D as O,af as _e,v as ie,b as B,cd as z,b_ as me,c7 as oe,b$ as G,bR as he,bY as Ce,u as Ie,x as Ne,w as Qe,l as Ke,T as Je,F as Le,cc as Xe,a8 as Ze,R as et,G as tt,a4 as st,ck as it,c0 as rt}from"../core-common.mjs";import{b as at}from"./index-CFlSzEWv.mjs";import{T as C}from"./index-YIotKjSS.mjs";import"./index-7XKGWWeV.mjs";import{B as F,z as Se}from"./_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import{n as A,bi as Oe,bj as He,bk as nt,a4 as ot,S as Ye,bl as ht,bm as Ue,bn as lt,bo as ct,bp as dt,aK as Me,b5 as ut,aL as Fe,bq as we,N as Pe,ak as ve,br as Z,bs as be,b4 as pt,bt as ft,bg as gt,bh as _t,bu as mt}from"./icons-DENytzON.mjs";import{d as pe}from"./index-D61A_Z5g.mjs";import{P as St}from"./index-BxD44Goc.mjs";import{i as Et}from"./vue-qrcode.esm-CarG3uCI.mjs";function fe(e){var s=typeof e;return e!=null&&(s=="object"||s=="function")}var yt=typeof X=="object"&&X&&X.Object===Object&&X,wt=typeof self=="object"&&self&&self.Object===Object&&self,We=yt||wt||Function("return this")(),le=function(){return We.Date.now()},Pt=/\s/;function vt(e){for(var s=e.length;s--&&Pt.test(e.charAt(s)););return s}var bt=/^\s+/;function Tt(e){return e&&e.slice(0,vt(e)+1).replace(bt,"")}var te=We.Symbol,Be=Object.prototype,At=Be.hasOwnProperty,Rt=Be.toString,V=te?te.toStringTag:void 0;function Dt(e){var s=At.call(e,V),i=e[V];try{e[V]=void 0;var r=!0}catch{}var a=Rt.call(e);return r&&(s?e[V]=i:delete e[V]),a}var xt=Object.prototype,kt=xt.toString;function Ct(e){return kt.call(e)}var It="[object Null]",Nt="[object Undefined]",Te=te?te.toStringTag:void 0;function Lt(e){return e==null?e===void 0?Nt:It:Te&&Te in Object(e)?Dt(e):Ct(e)}function Ot(e){return e!=null&&typeof e=="object"}var Ht="[object Symbol]";function Yt(e){return typeof e=="symbol"||Ot(e)&&Lt(e)==Ht}var Ae=NaN,Ut=/^[-+]0x[0-9a-f]+$/i,Mt=/^0b[01]+$/i,Ft=/^0o[0-7]+$/i,Wt=parseInt;function Re(e){if(typeof e=="number")return e;if(Yt(e))return Ae;if(fe(e)){var s=typeof e.valueOf=="function"?e.valueOf():e;e=fe(s)?s+"":s}if(typeof e!="string")return e===0?e:+e;e=Tt(e);var i=Mt.test(e);return i||Ft.test(e)?Wt(e.slice(2),i?2:8):Ut.test(e)?Ae:+e}var Bt="Expected a function",$t=Math.max,qt=Math.min;function jt(e,s,i){var r,a,n,l,h,_,g=0,x=!1,v=!1,m=!0;if(typeof e!="function")throw new TypeError(Bt);s=Re(s)||0,fe(i)&&(x=!!i.leading,v="maxWait"in i,n=v?$t(Re(i.maxWait)||0,s):n,m="trailing"in i?!!i.trailing:m);function D(d){var p=r,y=a;return r=a=void 0,g=d,l=e.apply(y,p),l}function u(d){return g=d,h=setTimeout(P,s),x?D(d):l}function S(d){var p=d-_,y=d-g,R=s-p;return v?qt(R,n-y):R}function E(d){var p=d-_,y=d-g;return _===void 0||p>=s||p<0||v&&y>=n}function P(){var d=le();if(E(d))return q(d);h=setTimeout(P,S(d))}function q(d){return h=void 0,m&&r?D(d):(r=a=void 0,l)}function J(){h!==void 0&&clearTimeout(h),g=0,r=_=a=h=void 0}function o(){return h===void 0?l:q(le())}function c(){var d=le(),p=E(d);if(r=arguments,a=this,_=d,p){if(h===void 0)return u(_);if(v)return clearTimeout(h),h=setTimeout(P,s),D(_)}return h===void 0&&(h=setTimeout(P,s)),l}return c.cancel=J,c.flush=o,c}var b={};Object.defineProperty(b,"__esModule",{value:!0}),b.generateUrl=b.generateRemoteUrl=N=b.generateOcsUrl=b.generateFilePath=void 0,b.getAppRootUrl=$e,b.getRootUrl=W,b.linkTo=b.imagePath=void 0;const Vt=(e,s)=>se(e,"",s);b.linkTo=Vt;const zt=e=>W()+"/remote.php/"+e,Gt=e=>window.location.protocol+"//"+window.location.host+zt(e);b.generateRemoteUrl=Gt;const Qt=(e,s,i)=>{const r=Object.assign({ocsVersion:2},i||{}).ocsVersion===1?1:2;return window.location.protocol+"//"+window.location.host+W()+"/ocs/v"+r+".php"+ge(e,s,i)};var N=b.generateOcsUrl=Qt;const ge=(e,s,i)=>{const r=Object.assign({escape:!0},i||{}),a=function(n,l){return l=l||{},n.replace(/{([^{}]*)}/g,function(h,_){var g=l[_];return r.escape?encodeURIComponent(typeof g=="string"||typeof g=="number"?g.toString():h):typeof g=="string"||typeof g=="number"?g.toString():h})};return e.charAt(0)!=="/"&&(e="/"+e),a(e,s||{})},Kt=(e,s,i)=>{var r;const a=Object.assign({noRewrite:!1},i||{});return((r=window)===null||r===void 0||(r=r.OC)===null||r===void 0||(r=r.config)===null||r===void 0?void 0:r.modRewriteWorking)===!0&&!a.noRewrite?W()+ge(e,s,i):W()+"/index.php"+ge(e,s,i)};b.generateUrl=Kt;const Jt=(e,s)=>s.indexOf(".")===-1?se(e,"img",s+".svg"):se(e,"img",s);b.imagePath=Jt;const se=(e,s,i)=>{var r;const a=((r=window)===null||r===void 0||(r=r.OC)===null||r===void 0||(r=r.coreApps)===null||r===void 0?void 0:r.indexOf(e))!==-1;let n=W();return i.substring(i.length-3)==="php"&&!a?(n+="/index.php/apps/"+e,i!=="index.php"&&(n+="/",s&&(n+=encodeURI(s+"/")),n+=i)):i.substring(i.length-3)!=="php"&&!a?(n=$e(e),s&&(n+="/"+s+"/"),n.substring(n.length-1)!=="/"&&(n+="/"),n+=i):((e==="settings"||e==="core"||e==="search")&&s==="ajax"?n+="/index.php/":n+="/",a||(n+="apps/"),e!==""&&(e+="/",n+=e),s&&(n+=s+"/"),n+=i),n};b.generateFilePath=se;function W(){let e=window._oc_webroot;if(typeof e>"u"){e=location.pathname;const s=e.indexOf("/index.php/");s!==-1?e=e.substr(0,s):e=e.substr(0,e.lastIndexOf("/"))}return e}function $e(e){var s,i;return(i=((s=window._oc_appswebroots)!==null&&s!==void 0?s:{})[e])!==null&&i!==void 0?i:""}class Xt{constructor(){this.http=I}listCollection(s){return this.http.get(N("collaboration/resources/collections/{collectionId}",{collectionId:s}))}renameCollection(s,i){return this.http.put(N("collaboration/resources/collections/{collectionId}",{collectionId:s}),{collectionName:i}).then(r=>r.data.ocs.data)}getCollectionsByResource(s,i){return this.http.get(N("collaboration/resources/{resourceType}/{resourceId}",{resourceType:s,resourceId:i})).then(r=>r.data.ocs.data)}createCollection(s,i,r){return this.http.post(N("collaboration/resources/{resourceType}/{resourceId}",{resourceType:s,resourceId:i}),{name:r}).then(a=>a.data.ocs.data)}addResource(s,i,r){return r=""+r,this.http.post(N("collaboration/resources/collections/{collectionId}",{collectionId:s}),{resourceType:i,resourceId:r}).then(a=>a.data.ocs.data)}removeResource(s,i,r){return this.http.delete(N("collaboration/resources/collections/{collectionId}",{collectionId:s}),{params:{resourceType:i,resourceId:r}}).then(a=>a.data.ocs.data)}search(s){return this.http.get(N("collaboration/resources/collections/search/{query}",{query:s})).then(i=>i.data.ocs.data)}}const U=new Xt,L=ue.observable({collections:[]}),M={addCollections(e){ee(L,"collections",e)},addCollection(e){L.collections.push(e)},removeCollection(e){ee(L,"collections",L.collections.filter(s=>s.id!==e))},updateCollection(e){const s=L.collections.findIndex(i=>i.id===e.id);s!==-1?ee(L.collections,s,e):L.collections.push(e)}},k={fetchCollectionsByResource({resourceType:e,resourceId:s}){return U.getCollectionsByResource(e,s).then(i=>(M.addCollections(i),i))},createCollection({baseResourceType:e,baseResourceId:s,resourceType:i,resourceId:r,name:a}){return U.createCollection(e,s,a).then(n=>{M.addCollection(n),k.addResourceToCollection({collectionId:n.id,resourceType:i,resourceId:r})})},renameCollection({collectionId:e,name:s}){return U.renameCollection(e,s).then(i=>(M.updateCollection(i),i))},addResourceToCollection({collectionId:e,resourceType:s,resourceId:i}){return U.addResource(e,s,i).then(r=>(M.updateCollection(r),r))},removeResource({collectionId:e,resourceType:s,resourceId:i}){return U.removeResource(e,s,i).then(r=>{r.resources.length>0?M.updateCollection(r):M.removeCollection(r)})},search(e){return U.search(e)}};function qe(e,s,i,r,a,n,l,h){var _=typeof e=="function"?e.options:e;return s&&(_.render=s,_.staticRenderFns=i,_._compiled=!0),n&&(_._scopeId="data-v-"+n),{exports:e,options:_}}const Zt={name:"CollectionListItem",components:{NcAvatar:O,NcActions:ie,NcActionButton:B},props:{collection:{type:Object,default:null}},data(){return{detailsOpen:!1,newName:null,error:{}}},computed:{getIcon(){return e=>[e.iconClass]},typeClass(){return e=>"resource-type-"+e.type},limitedResources(){return e=>e.resources?e.resources.slice(0,2):[]},iconUrl(){return e=>e.mimetype?OC.MimeType.getIconUrl(e.mimetype):e.iconUrl?e.iconUrl:""}},methods:{toggleDetails(){this.detailsOpen=!this.detailsOpen},showDetails(){this.detailsOpen=!0},hideDetails(){this.detailsOpen=!1},removeResource(e,s){k.removeResource({collectionId:e.id,resourceType:s.type,resourceId:s.id})},openRename(){this.newName=this.collection.name},renameCollection(){if(this.newName===""){this.newName=null;return}k.renameCollection({collectionId:this.collection.id,name:this.newName}).then(e=>{this.newName=null}).catch(e=>{this.$set(this.error,"rename",t("core","Failed to rename the project")),console.error(e),setTimeout(()=>{ee(this.error,"rename",null)},3e3)})}}};var es=function(){var e=this,s=e._self._c;return s("li",{staticClass:"collection-list-item"},[s("NcAvatar",{staticClass:"collection-avatar",attrs:{"display-name":e.collection.name,"allow-placeholder":""}}),e.newName===null?s("span",{staticClass:"collection-item-name",attrs:{title:""},on:{click:e.showDetails}},[e._v(e._s(e.collection.name))]):s("form",{class:{shouldshake:e.error.rename},on:{submit:function(i){return i.preventDefault(),e.renameCollection.apply(null,arguments)}}},[s("input",{directives:[{name:"model",rawName:"v-model",value:e.newName,expression:"newName"}],attrs:{type:"text",autocomplete:"off",autocapitalize:"off"},domProps:{value:e.newName},on:{input:function(i){i.target.composing||(e.newName=i.target.value)}}}),s("input",{staticClass:"icon-confirm",attrs:{type:"submit",value:""}})]),!e.detailsOpen&&e.newName===null?s("div",{staticClass:"linked-icons"},e._l(e.limitedResources(e.collection),function(i){return s("a",{key:i.type+"|"+i.id,class:e.typeClass(i),attrs:{title:i.name,href:i.link}},[s("img",{attrs:{src:e.iconUrl(i)}})])}),0):e._e(),e.newName===null?s("span",{staticClass:"sharingOptionsGroup"},[s("NcActions",[s("NcActionButton",{attrs:{icon:"icon-info"},on:{click:function(i){return i.preventDefault(),e.toggleDetails.apply(null,arguments)}}},[e._v(" "+e._s(e.detailsOpen?e.t("core","Hide details"):e.t("core","Show details"))+" ")]),s("NcActionButton",{attrs:{icon:"icon-rename"},on:{click:function(i){return i.preventDefault(),e.openRename.apply(null,arguments)}}},[e._v(" "+e._s(e.t("core","Rename project"))+" ")])],1)],1):e._e(),s("transition",{attrs:{name:"fade"}},[e.error.rename?s("div",{staticClass:"error"},[e._v(" "+e._s(e.error.rename)+" ")]):e._e()]),s("transition",{attrs:{name:"fade"}},[e.detailsOpen?s("ul",{staticClass:"resource-list-details"},e._l(e.collection.resources,function(i){return s("li",{key:i.type+"|"+i.id,class:e.typeClass(i)},[s("a",{attrs:{href:i.link}},[s("img",{attrs:{src:e.iconUrl(i)}}),s("span",{staticClass:"resource-name"},[e._v(e._s(i.name||""))])]),s("span",{staticClass:"icon-close",on:{click:function(r){return e.removeResource(e.collection,i)}}})])}),0):e._e()])],1)},ts=[],ss=qe(Zt,es,ts,!1,null,"8e58e0a5");const is=ss.exports,De=0,xe=1,rs=jt(function(e,s){e!==""&&(s(!0),k.search(e).then(i=>{this.searchCollections=i}).catch(i=>{console.error("Failed to search for collections",i)}).finally(()=>{s(!1)}))},500,{}),as={name:"CollectionList",components:{CollectionListItem:is,NcAvatar:O,NcSelect:_e},props:{type:{type:String,default:null},id:{type:String,default:null},name:{type:String,default:""},isActive:{type:Boolean,default:!0}},data(){return{selectIsOpen:!1,generatingCodes:!1,codes:void 0,value:null,model:{},searchCollections:[],error:null,state:L,isSelectOpen:!1}},computed:{collections(){return this.state.collections.filter(e=>typeof e.resources.find(s=>s&&s.id===""+this.id&&s.type===this.type)<"u")},placeholder(){return this.isSelectOpen?t("core","Type to search for existing projects"):t("core","Add to a project")},options(){const e=[];window.OCP.Collaboration.getTypes().sort().forEach(s=>{e.push({method:De,type:s,title:window.OCP.Collaboration.getLabel(s),class:window.OCP.Collaboration.getIcon(s),action:()=>window.OCP.Collaboration.trigger(s)})});for(const s in this.searchCollections)this.collections.findIndex(i=>i.id===this.searchCollections[s].id)===-1&&e.push({method:xe,title:this.searchCollections[s].name,collectionId:this.searchCollections[s].id});return e}},watch:{type(){this.isActive&&k.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},id(){this.isActive&&k.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},isActive(e){e&&k.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})}},mounted(){k.fetchCollectionsByResource({resourceType:this.type,resourceId:this.id})},methods:{select(e,s){e.method===De&&e.action().then(i=>{k.createCollection({baseResourceType:this.type,baseResourceId:this.id,resourceType:e.type,resourceId:i,name:this.name}).catch(r=>{this.setError(t("core","Failed to create a project"),r)})}).catch(i=>{console.error("No resource selected",i)}),e.method===xe&&k.addResourceToCollection({collectionId:e.collectionId,resourceType:this.type,resourceId:this.id}).catch(i=>{this.setError(t("core","Failed to add the item to the project"),i)})},search(e,s){rs.bind(this)(e,s)},showSelect(){this.selectIsOpen=!0,this.$refs.select.$el.focus()},hideSelect(){this.selectIsOpen=!1},isVueComponent(e){return e._isVue},setError(e,s){console.error(e,s),this.error=e,setTimeout(()=>{this.error=null},5e3)}}};var ns=function(){var e=this,s=e._self._c;return e.collections&&e.type&&e.id?s("ul",{staticClass:"collection-list",attrs:{id:"collection-list"}},[s("li",{on:{click:e.showSelect}},[e._m(0),s("div",{attrs:{id:"collection-select-container"}},[s("NcSelect",{ref:"select",attrs:{"aria-label-combobox":e.t("core","Add to a project"),options:e.options,placeholder:e.placeholder,label:"title",limit:5},on:{close:function(i){e.isSelectOpen=!1},open:function(i){e.isSelectOpen=!0},"option:selected":e.select,search:e.search},scopedSlots:e._u([{key:"selected-option",fn:function(i){return[s("span",{staticClass:"option__desc"},[s("span",{staticClass:"option__title"},[e._v(e._s(i.title))])])]}},{key:"option",fn:function(i){return[s("span",{staticClass:"option__wrapper"},[i.class?s("span",{staticClass:"avatar",class:i.class}):i.method!==2?s("NcAvatar",{attrs:{"allow-placeholder":"","display-name":i.title}}):e._e(),s("span",{staticClass:"option__title"},[e._v(e._s(i.title))])],1)]}}],null,!1,2397208459),model:{value:e.value,callback:function(i){e.value=i},expression:"value"}},[s("p",{staticClass:"hint"},[e._v(" "+e._s(e.t("core","Connect items to a project to make them easier to find"))+" ")])])],1)]),s("transition",{attrs:{name:"fade"}},[e.error?s("li",{staticClass:"error"},[e._v(" "+e._s(e.error)+" ")]):e._e()]),e._l(e.collections,function(i){return s("CollectionListItem",{key:i.id,attrs:{collection:i}})})],2):e._e()},os=[function(){var e=this,s=e._self._c;return s("div",{staticClass:"avatar"},[s("span",{staticClass:"icon-projects"})])}],hs=qe(as,ns,os,!1,null,"75a4370b");const ls=hs.exports;class re{constructor(){this._capabilities=z()}get defaultPermissions(){var s;return(s=this._capabilities.files_sharing)==null?void 0:s.default_permissions}get isPublicUploadEnabled(){var s;return(s=this._capabilities.files_sharing)==null?void 0:s.public.upload}get isShareWithLinkAllowed(){return document.getElementById("allowShareWithLink")&&document.getElementById("allowShareWithLink").value==="yes"}get federatedShareDocLink(){return OC.appConfig.core.federatedCloudShareDoc}get defaultExpirationDate(){return this.isDefaultExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultExpireDate)):null}get defaultInternalExpirationDate(){return this.isDefaultInternalExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultInternalExpireDate)):null}get defaultRemoteExpirationDateString(){return this.isDefaultRemoteExpireDateEnabled?new Date(new Date().setDate(new Date().getDate()+this.defaultRemoteExpireDate)):null}get enforcePasswordForPublicLink(){return OC.appConfig.core.enforcePasswordForPublicLink===!0}get enableLinkPasswordByDefault(){return OC.appConfig.core.enableLinkPasswordByDefault===!0}get isDefaultExpireDateEnforced(){return OC.appConfig.core.defaultExpireDateEnforced===!0}get isDefaultExpireDateEnabled(){return OC.appConfig.core.defaultExpireDateEnabled===!0}get isDefaultInternalExpireDateEnforced(){return OC.appConfig.core.defaultInternalExpireDateEnforced===!0}get isDefaultRemoteExpireDateEnforced(){return OC.appConfig.core.defaultRemoteExpireDateEnforced===!0}get isDefaultInternalExpireDateEnabled(){return OC.appConfig.core.defaultInternalExpireDateEnabled===!0}get isDefaultRemoteExpireDateEnabled(){return OC.appConfig.core.defaultRemoteExpireDateEnabled===!0}get isRemoteShareAllowed(){return OC.appConfig.core.remoteShareAllowed===!0}get isMailShareAllowed(){var s,i,r,a,n;return((i=(s=this._capabilities)==null?void 0:s.files_sharing)==null?void 0:i.sharebymail)!==void 0&&((n=(a=(r=this._capabilities)==null?void 0:r.files_sharing)==null?void 0:a.public)==null?void 0:n.enabled)===!0}get defaultExpireDate(){return OC.appConfig.core.defaultExpireDate}get defaultInternalExpireDate(){return OC.appConfig.core.defaultInternalExpireDate}get defaultRemoteExpireDate(){return OC.appConfig.core.defaultRemoteExpireDate}get isResharingAllowed(){return OC.appConfig.core.resharingAllowed===!0}get isPasswordForMailSharesRequired(){return this._capabilities.files_sharing.sharebymail===void 0?!1:this._capabilities.files_sharing.sharebymail.password.enforced}get shouldAlwaysShowUnique(){var s,i;return((i=(s=this._capabilities.files_sharing)==null?void 0:s.sharee)==null?void 0:i.always_show_unique)===!0}get allowGroupSharing(){return OC.appConfig.core.allowGroupSharing===!0}get maxAutocompleteResults(){return parseInt(OC.config["sharing.maxAutocompleteResults"],10)||25}get minSearchStringLength(){return parseInt(OC.config["sharing.minSearchStringLength"],10)||0}get passwordPolicy(){return this._capabilities.password_policy?this._capabilities.password_policy:{}}}const cs=function(e){return e.type===C.SHARE_TYPE_GROUP?t("files_sharing","Shared with you and the group {group} by {owner}",{group:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):e.type===C.SHARE_TYPE_CIRCLE?t("files_sharing","Shared with you and {circle} by {owner}",{circle:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):e.type===C.SHARE_TYPE_ROOM?e.shareWithDisplayName?t("files_sharing","Shared with you and the conversation {conversation} by {owner}",{conversation:e.shareWithDisplayName,owner:e.ownerDisplayName},void 0,{escape:!1}):t("files_sharing","Shared with you in a conversation by {owner}",{owner:e.ownerDisplayName},void 0,{escape:!1}):t("files_sharing","Shared with you by {owner}",{owner:e.ownerDisplayName},void 0,{escape:!1})};class T{constructor(s){ye(this,"_share");var i;if(s.ocs&&s.ocs.data&&s.ocs.data[0]&&(s=s.ocs.data[0]),s.hide_download=!!s.hide_download,s.mail_send=!!s.mail_send,s.attributes&&typeof s.attributes=="string")try{s.attributes=JSON.parse(s.attributes)}catch{console.warn("Could not parse share attributes returned by server",s.attributes)}s.attributes=(i=s.attributes)!=null?i:[],this._share=s}get state(){return this._share}get id(){return this._share.id}get type(){return this._share.share_type}get permissions(){return this._share.permissions}get attributes(){return this._share.attributes}set permissions(s){this._share.permissions=s}get owner(){return this._share.uid_owner}get ownerDisplayName(){return this._share.displayname_owner}get shareWith(){return this._share.share_with}get shareWithDisplayName(){return this._share.share_with_displayname||this._share.share_with}get shareWithDisplayNameUnique(){return this._share.share_with_displayname_unique||this._share.share_with}get shareWithLink(){return this._share.share_with_link}get shareWithAvatar(){return this._share.share_with_avatar}get uidFileOwner(){return this._share.uid_file_owner}get displaynameFileOwner(){return this._share.displayname_file_owner||this._share.uid_file_owner}get createdTime(){return this._share.stime}get expireDate(){return this._share.expiration}set expireDate(s){this._share.expiration=s}get token(){return this._share.token}get note(){return this._share.note}set note(s){this._share.note=s}get label(){var s;return(s=this._share.label)!=null?s:""}set label(s){this._share.label=s}get mailSend(){return this._share.mail_send===!0}get hideDownload(){return this._share.hide_download===!0}set hideDownload(s){this._share.hide_download=s===!0}get password(){return this._share.password}set password(s){this._share.password=s}get passwordExpirationTime(){return this._share.password_expiration_time}set passwordExpirationTime(s){this._share.password_expiration_time=s}get sendPasswordByTalk(){return this._share.send_password_by_talk}set sendPasswordByTalk(s){this._share.send_password_by_talk=s}get path(){return this._share.path}get itemType(){return this._share.item_type}get mimetype(){return this._share.mimetype}get fileSource(){return this._share.file_source}get fileTarget(){return this._share.file_target}get fileParent(){return this._share.file_parent}get hasReadPermission(){return!!(this.permissions&OC.PERMISSION_READ)}get hasCreatePermission(){return!!(this.permissions&OC.PERMISSION_CREATE)}get hasDeletePermission(){return!!(this.permissions&OC.PERMISSION_DELETE)}get hasUpdatePermission(){return!!(this.permissions&OC.PERMISSION_UPDATE)}get hasSharePermission(){return!!(this.permissions&OC.PERMISSION_SHARE)}get hasDownloadPermission(){for(const s in this._share.attributes){const i=this._share.attributes[s];if(i.scope==="permissions"&&i.key==="download")return i.enabled}return!0}set hasDownloadPermission(s){this.setAttribute("permissions","download",!!s)}setAttribute(s,i,r){const a={scope:s,key:i,enabled:r};for(const n in this._share.attributes){const l=this._share.attributes[n];if(l.scope===a.scope&&l.key===a.key){this._share.attributes.splice(n,1,a);return}}this._share.attributes.push(a)}get canEdit(){return this._share.can_edit===!0}get canDelete(){return this._share.can_delete===!0}get viaFileid(){return this._share.via_fileid}get viaPath(){return this._share.via_path}get parent(){return this._share.parent}get storageId(){return this._share.storage_id}get storage(){return this._share.storage}get itemSource(){return this._share.item_source}get status(){return this._share.status}}const H={data(){return{SHARE_TYPES:C}}},ds={name:"SharingEntrySimple",components:{NcActions:ie},props:{title:{type:String,default:"",required:!0},subtitle:{type:String,default:""},isUnique:{type:Boolean,default:!0},ariaExpanded:{type:Boolean,default:null}},computed:{ariaExpandedValue(){return this.ariaExpanded===null?this.ariaExpanded:this.ariaExpanded?"true":"false"}}};var us=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry"},[e._t("avatar"),s("div",{staticClass:"sharing-entry__desc"},[s("span",{staticClass:"sharing-entry__title"},[e._v(e._s(e.title))]),e.subtitle?s("p",[e._v(" "+e._s(e.subtitle)+" ")]):e._e()]),e.$slots.default?s("NcActions",{ref:"actionsComponent",staticClass:"sharing-entry__actions",attrs:{"menu-align":"right","aria-expanded":e.ariaExpandedValue}},[e._t("default")],2):e._e()],2)},ps=[],fs=A(ds,us,ps,!1,null,"5d40a20b");const ae=fs.exports,gs={name:"SharingEntryInternal",components:{NcActionButton:B,SharingEntrySimple:ae,CheckIcon:Oe,ClipboardIcon:He},props:{fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{copied:!1,copySuccess:!1}},computed:{internalLink(){return window.location.protocol+"//"+window.location.host+me("/f/")+this.fileInfo.id},copyLinkTooltip(){return this.copied?this.copySuccess?"":t("files_sharing","Cannot copy, please copy the link manually"):t("files_sharing","Copy internal link to clipboard")},internalLinkSubtitle(){return this.fileInfo.type==="dir"?t("files_sharing","Only works for people with access to this folder"):t("files_sharing","Only works for people with access to this file")}},methods:{async copyLink(){try{await navigator.clipboard.writeText(this.internalLink),F(t("files_sharing","Link copied")),this.$refs.shareEntrySimple.$refs.actionsComponent.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}}}};var _s=function(){var e=this,s=e._self._c;return s("ul",[s("SharingEntrySimple",{ref:"shareEntrySimple",staticClass:"sharing-entry__internal",attrs:{title:e.t("files_sharing","Internal link"),subtitle:e.internalLinkSubtitle},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("div",{staticClass:"avatar-external icon-external-white"})]},proxy:!0}])},[s("NcActionButton",{attrs:{title:e.copyLinkTooltip,"aria-label":e.copyLinkTooltip},on:{click:e.copyLink},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?s("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):s("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}])})],1)],1)},ms=[],Ss=A(gs,_s,ms,!1,null,"90488214");const Es=Ss.exports,ce=new re,ke="abcdefgijkmnopqrstwxyzABCDEFGHJKLMNPQRSTWXYZ23456789";async function Q(){if(ce.passwordPolicy.api&&ce.passwordPolicy.api.generate)try{const r=await I.get(ce.passwordPolicy.api.generate);if(r.data.ocs.data.password)return F(t("files_sharing","Password created successfully")),r.data.ocs.data.password}catch(r){console.info("Error generating password from password_policy",r),Se(t("files_sharing","Error generating password from password policy"))}const e=new Uint8Array(10),s=ke.length/255;self.crypto.getRandomValues(e);let i="";for(let r=0;r<e.length;r++)i+=ke.charAt(e[r]*s);return i}(function(e){var s=function(){try{if(e.URLSearchParams&&new e.URLSearchParams("foo=bar").get("foo")==="bar")return e.URLSearchParams}catch{}return null}(),i=s&&new s({a:1}).toString()==="a=1",r=s&&new s("s=%2B").get("s")==="+",a=s&&"size"in s.prototype,n="__URLSearchParams__",l=s?function(){var o=new s;return o.append("s"," &"),o.toString()==="s=+%26"}():!0,h=g.prototype,_=!!(e.Symbol&&e.Symbol.iterator);if(s&&i&&r&&l&&a)return;function g(o){o=o||"",(o instanceof URLSearchParams||o instanceof g)&&(o=o.toString()),this[n]=E(o)}h.append=function(o,c){P(this[n],o,c)},h.delete=function(o){delete this[n][o]},h.get=function(o){var c=this[n];return this.has(o)?c[o][0]:null},h.getAll=function(o){var c=this[n];return this.has(o)?c[o].slice(0):[]},h.has=function(o){return J(this[n],o)},h.set=function(o,c){this[n][o]=[""+c]},h.toString=function(){var o=this[n],c=[],d,p,y,R;for(p in o)for(y=D(p),d=0,R=o[p];d<R.length;d++)c.push(y+"="+D(R[d]));return c.join("&")};var x=e.Proxy&&s&&(!r||!l||!i||!a),v;x?(v=new Proxy(s,{construct:function(o,c){return new o(new g(c[0]).toString())}}),v.toString=Function.prototype.toString.bind(g)):v=g,Object.defineProperty(e,"URLSearchParams",{value:v});var m=e.URLSearchParams.prototype;m.polyfill=!0,!x&&e.Symbol&&(m[e.Symbol.toStringTag]="URLSearchParams"),"forEach"in m||(m.forEach=function(o,c){var d=E(this.toString());Object.getOwnPropertyNames(d).forEach(function(p){d[p].forEach(function(y){o.call(c,y,p,this)},this)},this)}),"sort"in m||(m.sort=function(){var o=E(this.toString()),c=[],d,p,y;for(d in o)c.push(d);for(c.sort(),p=0;p<c.length;p++)this.delete(c[p]);for(p=0;p<c.length;p++){var R=c[p],Y=o[R];for(y=0;y<Y.length;y++)this.append(R,Y[y])}}),"keys"in m||(m.keys=function(){var o=[];return this.forEach(function(c,d){o.push(d)}),S(o)}),"values"in m||(m.values=function(){var o=[];return this.forEach(function(c){o.push(c)}),S(o)}),"entries"in m||(m.entries=function(){var o=[];return this.forEach(function(c,d){o.push([d,c])}),S(o)}),_&&(m[e.Symbol.iterator]=m[e.Symbol.iterator]||m.entries),"size"in m||Object.defineProperty(m,"size",{get:function(){var o=E(this.toString());if(m===this)throw new TypeError("Illegal invocation at URLSearchParams.invokeGetter");return Object.keys(o).reduce(function(c,d){return c+o[d].length},0)}});function D(o){var c={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'\(\)~]|%20|%00/g,function(d){return c[d]})}function u(o){return o.replace(/[ +]/g,"%20").replace(/(%[a-f0-9]{2})+/ig,function(c){return decodeURIComponent(c)})}function S(o){var c={next:function(){var d=o.shift();return{done:d===void 0,value:d}}};return _&&(c[e.Symbol.iterator]=function(){return c}),c}function E(o){var c={};if(typeof o=="object")if(q(o))for(var d=0;d<o.length;d++){var p=o[d];if(q(p)&&p.length===2)P(c,p[0],p[1]);else throw new TypeError("Failed to construct 'URLSearchParams': Sequence initializer must only contain pair elements")}else for(var y in o)o.hasOwnProperty(y)&&P(c,y,o[y]);else{o.indexOf("?")===0&&(o=o.slice(1));for(var R=o.split("&"),Y=0;Y<R.length;Y++){var j=R[Y],ne=j.indexOf("=");-1<ne?P(c,u(j.slice(0,ne)),u(j.slice(ne+1))):j&&P(c,u(j),"")}}return c}function P(o,c,d){var p=typeof d=="string"?d:d!=null&&typeof d.toString=="function"?d.toString():JSON.stringify(d);J(o,c)?o[c].push(p):o[c]=[p]}function q(o){return!!o&&Object.prototype.toString.call(o)==="[object Array]"}function J(o,c){return Object.prototype.hasOwnProperty.call(o,c)}})(typeof oe<"u"?oe:typeof window<"u"?window:oe);const de=G("apps/files_sharing/api/v1/shares"),Ee={methods:{async createShare({path:e,permissions:s,shareType:i,shareWith:r,publicUpload:a,password:n,sendPasswordByTalk:l,expireDate:h,label:_,note:g,attributes:x}){var v,m,D,u,S;try{const E=await I.post(de,{path:e,permissions:s,shareType:i,shareWith:r,publicUpload:a,password:n,sendPasswordByTalk:l,expireDate:h,label:_,note:g,attributes:x});if(!((v=E==null?void 0:E.data)!=null&&v.ocs))throw E;const P=new T(E.data.ocs.data);return he("files_sharing:share:created",{share:P}),P}catch(E){console.error("Error while creating share",E);const P=(S=(u=(D=(m=E==null?void 0:E.response)==null?void 0:m.data)==null?void 0:D.ocs)==null?void 0:u.meta)==null?void 0:S.message;throw OC.Notification.showTemporary(P?t("files_sharing","Error creating the share: {errorMessage}",{errorMessage:P}):t("files_sharing","Error creating the share"),{type:"error"}),E}},async deleteShare(e){var s,i,r,a,n;try{const l=await I.delete(de+"/".concat(e));if(!((s=l==null?void 0:l.data)!=null&&s.ocs))throw l;return he("files_sharing:share:deleted",{id:e}),!0}catch(l){console.error("Error while deleting share",l);const h=(n=(a=(r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.ocs)==null?void 0:a.meta)==null?void 0:n.message;throw OC.Notification.showTemporary(h?t("files_sharing","Error deleting the share: {errorMessage}",{errorMessage:h}):t("files_sharing","Error deleting the share"),{type:"error"}),l}},async updateShare(e,s){var i,r,a,n,l;try{const h=await I.put(de+"/".concat(e),s);if(he("files_sharing:share:updated",{id:e}),(i=h==null?void 0:h.data)==null?void 0:i.ocs)return h.data.ocs.data;throw h}catch(h){if(console.error("Error while updating share",h),h.response.status!==400){const g=(l=(n=(a=(r=h==null?void 0:h.response)==null?void 0:r.data)==null?void 0:a.ocs)==null?void 0:n.meta)==null?void 0:l.message;OC.Notification.showTemporary(g?t("files_sharing","Error updating the share: {errorMessage}",{errorMessage:g}):t("files_sharing","Error updating the share"),{type:"error"})}const _=h.response.data.ocs.meta.message;throw new Error(_)}}}},$={methods:{async openSharingDetails(e){let s={};e.handler?(this.suggestions&&(e.suggestions=this.suggestions,e.fileInfo=this.fileInfo,e.query=this.query),s=await e.handler(e),s=new T(s)):s=this.mapShareRequestToShareObject(e);const i={fileInfo:this.fileInfo,share:s};this.$emit("open-sharing-details",i)},openShareDetailsForCustomSettings(e){e.setCustomPermissions=!0,this.openSharingDetails(e)},mapShareRequestToShareObject(e){if(e.id)return e;const s={attributes:[{enabled:!0,key:"download",scope:"permissions"}],share_type:e.shareType,share_with:e.shareWith,is_no_user:e.isNoUser,user:e.shareWith,share_with_displayname:e.displayName,subtitle:e.subtitle,permissions:e.permissions,expiration:""};return new T(s)}}},ys={name:"SharingInput",components:{NcSelect:_e},mixins:[H,Ee,$],props:{shares:{type:Array,default:()=>[],required:!0},linkShares:{type:Array,default:()=>[],required:!0},fileInfo:{type:Object,default:()=>{},required:!0},reshare:{type:T,default:null},canReshare:{type:Boolean,required:!0}},data(){return{config:new re,loading:!1,query:"",recommendations:[],ShareSearch:OCA.Sharing.ShareSearch.state,suggestions:[],value:null}},computed:{externalResults(){return this.ShareSearch.results},inputPlaceholder(){const e=this.config.isRemoteShareAllowed;return this.canReshare?e?t("files_sharing","Name, email, or Federated Cloud ID …"):t("files_sharing","Name or email …"):t("files_sharing","Resharing is not allowed")},isValidQuery(){return this.query&&this.query.trim()!==""&&this.query.length>this.config.minSearchStringLength},options(){return this.isValidQuery?this.suggestions:this.recommendations},noResultText(){return this.loading?t("files_sharing","Searching …"):t("files_sharing","No elements found.")}},mounted(){this.getRecommendations()},methods:{onSelected(e){this.value=null,this.openSharingDetails(e)},async asyncFind(e){this.query=e.trim(),this.isValidQuery&&(this.loading=!0,await this.debounceGetSuggestions(e))},async getSuggestions(e,s=!1){this.loading=!0,z().files_sharing.sharee.query_lookup_default===!0&&(s=!0);const i=[this.SHARE_TYPES.SHARE_TYPE_USER,this.SHARE_TYPES.SHARE_TYPE_GROUP,this.SHARE_TYPES.SHARE_TYPE_REMOTE,this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP,this.SHARE_TYPES.SHARE_TYPE_CIRCLE,this.SHARE_TYPES.SHARE_TYPE_ROOM,this.SHARE_TYPES.SHARE_TYPE_GUEST,this.SHARE_TYPES.SHARE_TYPE_DECK,this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH];z().files_sharing.public.enabled===!0&&i.push(this.SHARE_TYPES.SHARE_TYPE_EMAIL);let r=null;try{r=await I.get(G("apps/files_sharing/api/v1/sharees"),{params:{format:"json",itemType:this.fileInfo.type==="dir"?"folder":"file",search:e,lookup:s,perPage:this.config.maxAutocompleteResults,shareType:i}})}catch(u){console.error("Error fetching suggestions",u);return}const a=r.data.ocs.data,n=r.data.ocs.data.exact;a.exact=[];const l=Object.values(n).reduce((u,S)=>u.concat(S),[]),h=Object.values(a).reduce((u,S)=>u.concat(S),[]),_=this.filterOutExistingShares(l).map(u=>this.formatForMultiselect(u)).sort((u,S)=>u.shareType-S.shareType),g=this.filterOutExistingShares(h).map(u=>this.formatForMultiselect(u)).sort((u,S)=>u.shareType-S.shareType),x=[];a.lookupEnabled&&!s&&x.push({id:"global-lookup",isNoUser:!0,displayName:t("files_sharing","Search globally"),lookup:!0});const v=this.externalResults.filter(u=>!u.condition||u.condition(this)),m=_.concat(g).concat(v).concat(x),D=m.reduce((u,S)=>(S.displayName&&(u[S.displayName]||(u[S.displayName]=0),u[S.displayName]++),u),{});this.suggestions=m.map(u=>D[u.displayName]>1&&!u.desc?{...u,desc:u.shareWithDisplayNameUnique}:u),this.loading=!1,console.info("suggestions",this.suggestions)},debounceGetSuggestions:pe(function(...e){this.getSuggestions(...e)},300),async getRecommendations(){this.loading=!0;let e=null;try{e=await I.get(G("apps/files_sharing/api/v1/sharees_recommended"),{params:{format:"json",itemType:this.fileInfo.type}})}catch(r){console.error("Error fetching recommendations",r);return}const s=this.externalResults.filter(r=>!r.condition||r.condition(this)),i=Object.values(e.data.ocs.data.exact).reduce((r,a)=>r.concat(a),[]);this.recommendations=this.filterOutExistingShares(i).map(r=>this.formatForMultiselect(r)).concat(s),this.loading=!1,console.info("recommendations",this.recommendations)},filterOutExistingShares(e){return e.reduce((s,i)=>{if(typeof i!="object")return s;try{if(i.value.shareType===this.SHARE_TYPES.SHARE_TYPE_USER&&(i.value.shareWith===Ce().uid||this.reshare&&i.value.shareWith===this.reshare.owner))return s;if(i.value.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL){if(this.linkShares.map(r=>r.shareWith).indexOf(i.value.shareWith.trim())!==-1)return s}else{const r=this.shares.reduce((n,l)=>(n[l.shareWith]=l.type,n),{}),a=i.value.shareWith.trim();if(a in r&&r[a]===i.value.shareType)return s}s.push(i)}catch{return s}return s},[])},shareTypeToIcon(e){switch(e){case this.SHARE_TYPES.SHARE_TYPE_GUEST:return{icon:"icon-user",iconTitle:t("files_sharing","Guest")};case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:case this.SHARE_TYPES.SHARE_TYPE_GROUP:return{icon:"icon-group",iconTitle:t("files_sharing","Group")};case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return{icon:"icon-mail",iconTitle:t("files_sharing","Email")};case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return{icon:"icon-teams",iconTitle:t("files_sharing","Team")};case this.SHARE_TYPES.SHARE_TYPE_ROOM:return{icon:"icon-room",iconTitle:t("files_sharing","Talk conversation")};case this.SHARE_TYPES.SHARE_TYPE_DECK:return{icon:"icon-deck",iconTitle:t("files_sharing","Deck board")};case this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH:return{icon:"icon-sciencemesh",iconTitle:t("files_sharing","ScienceMesh")};default:return{}}},formatForMultiselect(e){var i,r;let s;return e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_USER&&this.config.shouldAlwaysShowUnique?s=(i=e.shareWithDisplayNameUnique)!=null?i:"":(e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_REMOTE||e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP)&&e.value.server?s=t("files_sharing","on {server}",{server:e.value.server}):e.value.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL?s=e.value.shareWith:s=(r=e.shareWithDescription)!=null?r:"",{shareWith:e.value.shareWith,shareType:e.value.shareType,user:e.uuid||e.value.shareWith,isNoUser:e.value.shareType!==this.SHARE_TYPES.SHARE_TYPE_USER,displayName:e.name||e.label,subtitle:s,shareWithDisplayNameUnique:e.shareWithDisplayNameUnique||"",...this.shareTypeToIcon(e.value.shareType)}},async addShare(e){if(this.value=null,e.lookup)return await this.getSuggestions(this.query,!0),this.$nextTick(()=>{this.$refs.select.$children[0].open=!0}),!0;if(e.handler){const s=await e.handler(this);return this.$emit("add:share",new T(s)),!0}this.loading=!0,console.debug("Adding a new share from the input for",e);try{let s=null;this.config.enforcePasswordForPublicLink&&e.shareType===this.SHARE_TYPES.SHARE_TYPE_EMAIL&&(s=await Q());const i=(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),r=await this.createShare({path:i,shareType:e.shareType,shareWith:e.shareWith,password:s,permissions:this.fileInfo.sharePermissions&z().files_sharing.default_permissions,attributes:JSON.stringify(this.fileInfo.shareAttributes)});if(s){r.newPassword=s;const a=await new Promise(n=>{this.$emit("add:share",r,n)});a.open=!0}else this.$emit("add:share",r);await this.getRecommendations()}catch(s){this.$nextTick(()=>{this.$refs.select.$children[0].open=!0}),this.query=e.shareWith,console.error("Error while adding new share",s)}finally{this.loading=!1}}}};var ws=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sharing-search"},[s("label",{attrs:{for:"sharing-search-input"}},[e._v(e._s(e.t("files_sharing","Search for share recipients")))]),s("NcSelect",{ref:"select",staticClass:"sharing-search__input",attrs:{"input-id":"sharing-search-input",disabled:!e.canReshare,loading:e.loading,filterable:!1,placeholder:e.inputPlaceholder,"clear-search-on-blur":()=>!1,"user-select":!0,options:e.options},on:{search:e.asyncFind,"option:selected":e.onSelected},scopedSlots:e._u([{key:"no-options",fn:function({search:i}){return[e._v(" "+e._s(i?e.noResultText:e.t("files_sharing","No recommendations. Start typing."))+" ")]}}]),model:{value:e.value,callback:function(i){e.value=i},expression:"value"}})],1)},Ps=[],vs=A(ys,ws,Ps,!1,null,null);const bs=vs.exports,f={NONE:0,READ:1,UPDATE:2,CREATE:4,DELETE:8,SHARE:16},w={READ_ONLY:f.READ,UPLOAD_AND_UPDATE:f.READ|f.UPDATE|f.CREATE|f.DELETE,FILE_DROP:f.CREATE,ALL:f.UPDATE|f.CREATE|f.READ|f.DELETE|f.SHARE,ALL_FILE:f.UPDATE|f.READ|f.SHARE};function Ts(e,s){return e!==f.NONE&&(e&s)===s}const K={mixins:[Ee,H],props:{fileInfo:{type:Object,default:()=>{},required:!0},share:{type:T,default:null},isUnique:{type:Boolean,default:!0}},data(){var e;return{config:new re,errors:{},loading:!1,saving:!1,open:!1,updateQueue:new St({concurrency:1}),reactiveState:(e=this.share)==null?void 0:e.state}},computed:{hasNote:{get(){return this.share.note!==""},set(e){this.share.note=e?null:""}},dateTomorrow(){return new Date(new Date().setDate(new Date().getDate()+1))},lang(){const e=window.dayNamesShort?window.dayNamesShort:["Sun.","Mon.","Tue.","Wed.","Thu.","Fri.","Sat."],s=window.monthNamesShort?window.monthNamesShort:["Jan.","Feb.","Mar.","Apr.","May.","Jun.","Jul.","Aug.","Sep.","Oct.","Nov.","Dec."];return{formatLocale:{firstDayOfWeek:window.firstDay?window.firstDay:0,monthsShort:s,weekdaysMin:e,weekdaysShort:e},monthFormat:"MMM"}},isFolder(){return this.fileInfo.type==="dir"},isPublicShare(){var s;const e=(s=this.share.shareType)!=null?s:this.share.type;return[this.SHARE_TYPES.SHARE_TYPE_LINK,this.SHARE_TYPES.SHARE_TYPE_EMAIL].includes(e)},isRemoteShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP||this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE},isShareOwner(){return this.share&&this.share.owner===Ce().uid},isExpiryDateEnforced(){return this.isPublicShare?this.config.isDefaultExpireDateEnforced:this.isRemoteShare?this.config.isDefaultRemoteExpireDateEnforced:this.config.isDefaultInternalExpireDateEnforced},hasCustomPermissions(){return![w.ALL,w.READ_ONLY,w.FILE_DROP].includes(this.share.permissions)},maxExpirationDateEnforced(){return this.isExpiryDateEnforced?this.isPublicShare?this.config.defaultExpirationDate:this.isRemoteShare?this.config.defaultRemoteExpirationDateString:this.config.defaultInternalExpirationDate:null}},methods:{checkShare(e){return!(e.password&&(typeof e.password!="string"||e.password.trim()==="")||e.expirationDate&&!e.expirationDate.isValid())},parseDateString(e){var i;if(!e)return;const s=/([0-9]{4}-[0-9]{2}-[0-9]{2})/i;return new Date((i=e.match(s))==null?void 0:i.pop())},formatDateToString(e){return new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate())).toISOString().split("T")[0]},onExpirationChange:pe(function(e){this.share.expireDate=this.formatDateToString(new Date(e))},500),onExpirationDisable(){this.share.expireDate=""},onNoteChange(e){this.$set(this.share,"newNote",e.trim())},onNoteSubmit(){this.share.newNote&&(this.share.note=this.share.newNote,this.$delete(this.share,"newNote"),this.queueUpdate("note"))},async onDelete(){try{this.loading=!0,this.open=!1,await this.deleteShare(this.share.id),console.debug("Share deleted",this.share.id);const e=this.share.itemType==="file"?t("files_sharing",'File "{path}" has been unshared',{path:this.share.path}):t("files_sharing",'Folder "{path}" has been unshared',{path:this.share.path});F(e),this.$emit("remove:share",this.share)}catch{this.open=!0}finally{this.loading=!1}},queueUpdate(...e){if(e.length!==0){if(this.share.id){const s={};e.forEach(i=>{typeof this.share[i]=="object"?s[i]=JSON.stringify(this.share[i]):s[i]=this.share[i].toString()}),this.updateQueue.add(async()=>{this.saving=!0,this.errors={};try{const i=await this.updateShare(this.share.id,s);e.indexOf("password")>=0&&(this.$delete(this.share,"newPassword"),this.share.passwordExpirationTime=i.password_expiration_time),this.$delete(this.errors,e[0]),F(t("files_sharing","Share {propertyName} saved",{propertyName:e[0]}))}catch({message:i}){i&&i!==""&&(this.onSyncError(e[0],i),Se(t("files_sharing",i)))}finally{this.saving=!1}});return}console.debug("Updated local share",this.share)}},onSyncError(e,s){switch(this.open=!0,e){case"password":case"pending":case"expireDate":case"label":case"note":{this.$set(this.errors,e,s);let i=this.$refs[e];if(i){i.$el&&(i=i.$el);const r=i.querySelector(".focusable");r&&r.focus()}break}case"sendPasswordByTalk":{this.$set(this.errors,e,s),this.share.sendPasswordByTalk=!this.share.sendPasswordByTalk;break}}},debounceQueueUpdate:pe(function(e){this.queueUpdate(e)},500)}},As={name:"SharingEntryInherited",components:{NcActionButton:B,NcActionLink:Ie,NcActionText:Ne,NcAvatar:O,SharingEntrySimple:ae},mixins:[K],props:{share:{type:T,required:!0}},computed:{viaFileTargetUrl(){return me("/f/{fileid}",{fileid:this.share.viaFileid})},viaFolderName(){return at(this.share.viaPath)}}};var Rs=function(){var e=this,s=e._self._c;return s("SharingEntrySimple",{key:e.share.id,staticClass:"sharing-entry__inherited",attrs:{title:e.share.shareWithDisplayName},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{user:e.share.shareWith,"display-name":e.share.shareWithDisplayName}})]},proxy:!0}])},[s("NcActionText",{attrs:{icon:"icon-user"}},[e._v(" "+e._s(e.t("files_sharing","Added by {initiator}",{initiator:e.share.ownerDisplayName}))+" ")]),e.share.viaPath&&e.share.viaFileid?s("NcActionLink",{attrs:{icon:"icon-folder",href:e.viaFileTargetUrl}},[e._v(" "+e._s(e.t("files_sharing","Via “{folder}”",{folder:e.viaFolderName}))+" ")]):e._e(),e.share.canDelete?s("NcActionButton",{attrs:{icon:"icon-close"},on:{click:function(i){return i.preventDefault(),e.onDelete.apply(null,arguments)}}},[e._v(" "+e._s(e.t("files_sharing","Unshare"))+" ")]):e._e()],1)},Ds=[],xs=A(As,Rs,Ds,!1,null,"761ebf41");const ks=xs.exports,Cs={name:"SharingInherited",components:{NcActionButton:B,SharingEntryInherited:ks,SharingEntrySimple:ae},props:{fileInfo:{type:Object,default:()=>{},required:!0}},data(){return{loaded:!1,loading:!1,showInheritedShares:!1,shares:[]}},computed:{showInheritedSharesIcon(){return this.loading?"icon-loading-small":this.showInheritedShares?"icon-triangle-n":"icon-triangle-s"},mainTitle(){return t("files_sharing","Others with access")},subTitle(){return this.showInheritedShares&&this.shares.length===0?t("files_sharing","No other accounts with access found"):""},toggleTooltip(){return this.fileInfo.type==="dir"?t("files_sharing","Toggle list of others with access to this directory"):t("files_sharing","Toggle list of others with access to this file")},fullPath(){return"".concat(this.fileInfo.path,"/").concat(this.fileInfo.name).replace("//","/")}},watch:{fileInfo(){this.resetState()}},methods:{toggleInheritedShares(){this.showInheritedShares=!this.showInheritedShares,this.showInheritedShares?this.fetchInheritedShares():this.resetState()},async fetchInheritedShares(){this.loading=!0;try{const e=G("apps/files_sharing/api/v1/shares/inherited?format=json&path={path}",{path:this.fullPath}),s=await I.get(e);this.shares=s.data.ocs.data.map(i=>new T(i)).sort((i,r)=>r.createdTime-i.createdTime),console.info(this.shares),this.loaded=!0}catch{OC.Notification.showTemporary(t("files_sharing","Unable to fetch inherited shares"),{type:"error"})}finally{this.loading=!1}},resetState(){this.loaded=!1,this.loading=!1,this.showInheritedShares=!1,this.shares=[]},removeShare(e){const s=this.shares.findIndex(i=>i===e);this.shares.splice(s,1)}}};var Is=function(){var e=this,s=e._self._c;return s("ul",{attrs:{id:"sharing-inherited-shares"}},[s("SharingEntrySimple",{staticClass:"sharing-entry__inherited",attrs:{title:e.mainTitle,subtitle:e.subTitle,"aria-expanded":e.showInheritedShares},scopedSlots:e._u([{key:"avatar",fn:function(){return[s("div",{staticClass:"avatar-shared icon-more-white"})]},proxy:!0}])},[s("NcActionButton",{attrs:{icon:e.showInheritedSharesIcon,"aria-label":e.toggleTooltip,title:e.toggleTooltip},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.toggleInheritedShares.apply(null,arguments)}}})],1),e._l(e.shares,function(i){return s("SharingEntryInherited",{key:i.id,attrs:{"file-info":e.fileInfo,share:i},on:{"remove:share":e.removeShare}})})],2)},Ns=[],Ls=A(Cs,Is,Ns,!1,null,"41bda888");const Os=Ls.exports,Hs={name:"SharingEntryQuickShareSelect",components:{DropdownIcon:nt,NcActions:ie,NcActionButton:B},mixins:[K,$,H],props:{share:{type:Object,required:!0}},emits:["open-sharing-details"],data(){return{selectedOption:""}},computed:{ariaLabel(){return t("files_sharing",'Quick share options, the current selected is "{selectedOption}"',{selectedOption:this.selectedOption})},canViewText(){return t("files_sharing","View only")},canEditText(){return t("files_sharing","Can edit")},fileDropText(){return t("files_sharing","File drop")},customPermissionsText(){return t("files_sharing","Custom permissions")},preSelectedOption(){return(this.share.permissions&~f.SHARE)===w.READ_ONLY?this.canViewText:this.share.permissions===w.ALL||this.share.permissions===w.ALL_FILE?this.canEditText:(this.share.permissions&~f.SHARE)===w.FILE_DROP?this.fileDropText:this.customPermissionsText},options(){const e=[{label:this.canViewText,icon:ot},{label:this.canEditText,icon:Ye}];return this.supportsFileDrop&&e.push({label:this.fileDropText,icon:ht}),e.push({label:this.customPermissionsText,icon:Ue}),e},supportsFileDrop(){var e;if(this.isFolder&&this.config.isPublicUploadEnabled){const s=(e=this.share.type)!=null?e:this.share.shareType;return[this.SHARE_TYPES.SHARE_TYPE_LINK,this.SHARE_TYPES.SHARE_TYPE_EMAIL].includes(s)}return!1},dropDownPermissionValue(){switch(this.selectedOption){case this.canEditText:return this.isFolder?w.ALL:w.ALL_FILE;case this.fileDropText:return w.FILE_DROP;case this.customPermissionsText:return"custom";case this.canViewText:default:return w.READ_ONLY}}},created(){this.selectedOption=this.preSelectedOption},methods:{selectOption(e){this.selectedOption=e,e===this.customPermissionsText?this.$emit("open-sharing-details"):(this.share.permissions=this.dropDownPermissionValue,this.queueUpdate("permissions"),this.$refs.quickShareActions.$refs.menuButton.$el.focus())}}};var Ys=function(){var e=this,s=e._self._c;return s("NcActions",{ref:"quickShareActions",staticClass:"share-select",attrs:{"menu-name":e.selectedOption,"aria-label":e.ariaLabel,type:"tertiary-no-background","force-name":""},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DropdownIcon",{attrs:{size:15}})]},proxy:!0}])},e._l(e.options,function(i){return s("NcActionButton",{key:i.label,attrs:{type:"radio","model-value":i.label===e.selectedOption,"close-after-click":""},on:{click:function(r){return e.selectOption(i.label)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s(i.icon,{tag:"component"})]},proxy:!0}],null,!0)},[e._v(" "+e._s(i.label)+" ")])}),1)},Us=[],Ms=A(Hs,Ys,Us,!1,null,"25f0f821");const je=Ms.exports,Fs={name:"ExternalShareAction",props:{id:{type:String,required:!0},action:{type:Object,default:()=>({})},fileInfo:{type:Object,default:()=>{},required:!0},share:{type:T,default:null}},computed:{data(){return this.action.data(this)}}};var Ws=function(){var e=this,s=e._self._c;return s(e.data.is,e._g(e._b({tag:"Component"},"Component",e.data,!1),e.action.handlers),[e._v(" "+e._s(e.data.text)+" ")])},Bs=[],$s=A(Fs,Ws,Bs,!1,null,null);const Ve=$s.exports,qs={name:"SharingEntryLink",components:{ExternalShareAction:Ve,NcActions:ie,NcActionButton:B,NcActionInput:Qe,NcActionLink:Ie,NcActionText:Ne,NcActionSeparator:Ke,NcAvatar:O,NcDialog:Je,VueQrcode:Et,Tune:Ue,IconQr:lt,ErrorIcon:ct,LockIcon:dt,CheckIcon:Oe,ClipboardIcon:He,CloseIcon:Me,PlusIcon:ut,SharingEntryQuickShareSelect:je},mixins:[K,$],props:{canReshare:{type:Boolean,default:!0},index:{type:Number,default:null}},data(){return{copySuccess:!0,copied:!1,pending:!1,ExternalLegacyLinkActions:OCA.Sharing.ExternalLinkActions.state,ExternalShareActions:OCA.Sharing.ExternalShareActions.state,showQRCode:!1}},computed:{title(){if(this.share&&this.share.id){if(!this.isShareOwner&&this.share.ownerDisplayName)return this.isEmailShareType?t("files_sharing","{shareWith} by {initiator}",{shareWith:this.share.shareWith,initiator:this.share.ownerDisplayName}):t("files_sharing","Shared via link by {initiator}",{initiator:this.share.ownerDisplayName});if(this.share.label&&this.share.label.trim()!=="")return this.isEmailShareType?t("files_sharing","Mail share ({label})",{label:this.share.label.trim()}):t("files_sharing","Share link ({label})",{label:this.share.label.trim()});if(this.isEmailShareType)return this.share.shareWith}return this.index>1?t("files_sharing","Share link ({index})",{index:this.index}):t("files_sharing","Share link")},subtitle(){return this.isEmailShareType&&this.title!==this.share.shareWith?this.share.shareWith:null},isPasswordProtected:{get(){return this.config.enforcePasswordForPublicLink||!!this.share.password},async set(e){ue.set(this.share,"password",e?await Q():""),ue.set(this.share,"newPassword",this.share.password)}},passwordExpirationTime(){if(this.share.passwordExpirationTime===null)return null;const e=moment(this.share.passwordExpirationTime);return e.diff(moment())<0?!1:e.fromNow()},isTalkEnabled(){return OC.appswebroots.spreed!==void 0},isPasswordProtectedByTalkAvailable(){return this.isPasswordProtected&&this.isTalkEnabled},isPasswordProtectedByTalk:{get(){return this.share.sendPasswordByTalk},async set(e){this.share.sendPasswordByTalk=e}},isEmailShareType(){return this.share?this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL:!1},canTogglePasswordProtectedByTalkAvailable(){if(this.isPasswordProtected){if(this.isEmailShareType&&!this.hasUnsavedPassword)return!1}else return!1;return!0},pendingPassword(){return this.config.enableLinkPasswordByDefault&&this.share&&!this.share.id},pendingEnforcedPassword(){return this.config.enforcePasswordForPublicLink&&this.share&&!this.share.id},pendingExpirationDate(){return this.config.isDefaultExpireDateEnforced&&this.share&&!this.share.id},hasUnsavedPassword(){return this.share.newPassword!==void 0},shareLink(){return window.location.protocol+"//"+window.location.host+me("/s/")+this.share.token},actionsTooltip(){return t("files_sharing",'Actions for "{title}"',{title:this.title})},copyLinkTooltip(){return this.copied?this.copySuccess?"":t("files_sharing","Cannot copy, please copy the link manually"):t("files_sharing",'Copy public link of "{title}" to clipboard',{title:this.title})},externalLegacyLinkActions(){return this.ExternalLegacyLinkActions.actions},externalLinkActions(){const e=s=>(s.shareType.includes(C.SHARE_TYPE_LINK)||s.shareType.includes(C.SHARE_TYPE_EMAIL))&&!s.advanced;return this.ExternalShareActions.actions.filter(e)},isPasswordPolicyEnabled(){return typeof this.config.passwordPolicy=="object"},canChangeHideDownload(){const e=s=>s.key==="download"&&s.scope==="permissions"&&s.enabled===!1;return this.fileInfo.shareAttributes.some(e)}},methods:{async onNewLinkShare(){if(this.loading)return;const e={share_type:C.SHARE_TYPE_LINK};if(this.config.isDefaultExpireDateEnforced&&(e.expiration=this.formatDateToString(this.config.defaultExpirationDate)),this.config.enableLinkPasswordByDefault||this.config.enforcePasswordForPublicLink||this.config.isDefaultExpireDateEnforced){if(this.pending=!0,this.share&&!this.share.id)if(this.checkShare(this.share)){try{await this.pushNewLinkShare(this.share,!0)}catch(r){return this.pending=!1,console.error(r),!1}return!0}else return this.open=!0,OC.Notification.showTemporary(t("files_sharing","Error, please enter proper password and/or expiration date")),!1;(this.config.enableLinkPasswordByDefault||this.config.enforcePasswordForPublicLink)&&(e.password=await Q());const s=new T(e),i=await new Promise(r=>{this.$emit("add:share",s,r)});this.open=!1,this.pending=!1,i.open=!0}else{const s=new T(e);await this.pushNewLinkShare(s)}},async pushNewLinkShare(e,s){var i,r,a,n;try{if(this.loading)return!0;this.loading=!0,this.errors={};const l={path:(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),shareType:C.SHARE_TYPE_LINK,password:e.password,expireDate:e.expireDate,attributes:JSON.stringify(this.fileInfo.shareAttributes)};console.debug("Creating link share with options",l);const h=await this.createShare(l);this.open=!1,console.debug("Link share created",h);let _;s?_=await new Promise(g=>{this.$emit("update:share",h,g)}):_=await new Promise(g=>{this.$emit("add:share",h,g)}),this.config.enforcePasswordForPublicLink||_.copyLink(),F(t("files_sharing","Link share created"))}catch(l){const h=(n=(a=(r=(i=l==null?void 0:l.response)==null?void 0:i.data)==null?void 0:r.ocs)==null?void 0:a.meta)==null?void 0:n.message;if(!h){Se(t("files_sharing","Error while creating the share")),console.error(l);return}throw h.match(/password/i)?this.onSyncError("password",h):h.match(/date/i)?this.onSyncError("expireDate",h):this.onSyncError("pending",h),l}finally{this.loading=!1}},async copyLink(){try{await navigator.clipboard.writeText(this.shareLink),F(t("files_sharing","Link copied")),this.$refs.copyButton.$el.focus(),this.copySuccess=!0,this.copied=!0}catch(e){this.copySuccess=!1,this.copied=!0,console.error(e)}finally{setTimeout(()=>{this.copySuccess=!1,this.copied=!1},4e3)}},onPasswordChange(e){this.$set(this.share,"newPassword",e)},onPasswordDisable(){this.share.password="",this.$delete(this.share,"newPassword"),this.share.id&&this.queueUpdate("password")},onPasswordSubmit(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim(),this.queueUpdate("password"))},onPasswordProtectedByTalkChange(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim()),this.queueUpdate("sendPasswordByTalk","password")},onMenuClose(){this.onPasswordSubmit(),this.onNoteSubmit()},onCancel(){this.$emit("remove:share",this.share)}}};var js=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry sharing-entry__link",class:{"sharing-entry--share":e.share}},[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":!0,"icon-class":e.isEmailShareType?"avatar-link-share icon-mail-white":"avatar-link-share icon-public-white"}}),s("div",{staticClass:"sharing-entry__summary"},[s("div",{staticClass:"sharing-entry__desc"},[s("span",{staticClass:"sharing-entry__title",attrs:{title:e.title}},[e._v(" "+e._s(e.title)+" ")]),e.subtitle?s("p",[e._v(" "+e._s(e.subtitle)+" ")]):e._e(),e.share&&e.share.permissions!==void 0?s("SharingEntryQuickShareSelect",{attrs:{share:e.share,"file-info":e.fileInfo},on:{"open-sharing-details":function(i){return e.openShareDetailsForCustomSettings(e.share)}}}):e._e()],1),e.share&&!e.isEmailShareType&&e.share.token?s("NcActions",{ref:"copyButton",staticClass:"sharing-entry__copy"},[s("NcActionButton",{attrs:{title:e.copyLinkTooltip,"aria-label":e.copyLinkTooltip},on:{click:function(i){return i.preventDefault(),e.copyLink.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.copied&&e.copySuccess?s("CheckIcon",{staticClass:"icon-checkmark-color",attrs:{size:20}}):s("ClipboardIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,4269614823)})],1):e._e()],1),!e.pending&&(e.pendingPassword||e.pendingEnforcedPassword||e.pendingExpirationDate)?s("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.actionsTooltip,"menu-align":"right",open:e.open},on:{"update:open":function(i){e.open=i},close:e.onCancel}},[e.errors.pending?s("NcActionText",{staticClass:"error",scopedSlots:e._u([{key:"icon",fn:function(){return[s("ErrorIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,1966124155)},[e._v(" "+e._s(e.errors.pending)+" ")]):s("NcActionText",{attrs:{icon:"icon-info"}},[e._v(" "+e._s(e.t("files_sharing","Please enter the following required information before creating the share"))+" ")]),e.pendingEnforcedPassword?s("NcActionText",[s("LockIcon",{attrs:{size:20}}),e._v(" "+e._s(e.t("files_sharing","Password protection (enforced)"))+" ")],1):e.pendingPassword?s("NcActionCheckbox",{staticClass:"share-link-password-checkbox",attrs:{checked:e.isPasswordProtected,disabled:e.config.enforcePasswordForPublicLink||e.saving},on:{"update:checked":function(i){e.isPasswordProtected=i},uncheck:e.onPasswordDisable}},[e._v(" "+e._s(e.t("files_sharing","Password protection"))+" ")]):e._e(),e.pendingEnforcedPassword||e.share.password?s("NcActionInput",{staticClass:"share-link-password",attrs:{value:e.share.password,disabled:e.saving,required:e.config.enableLinkPasswordByDefault||e.config.enforcePasswordForPublicLink,minlength:e.isPasswordPolicyEnabled&&e.config.passwordPolicy.minLength,icon:"",autocomplete:"new-password"},on:{"update:value":function(i){return e.$set(e.share,"password",i)},submit:e.onNewLinkShare}},[e._v(" "+e._s(e.t("files_sharing","Enter a password"))+" ")]):e._e(),e.pendingExpirationDate?s("NcActionText",{attrs:{icon:"icon-calendar-dark"}},[e._v(" "+e._s(e.t("files_sharing","Expiration date (enforced)"))+" ")]):e._e(),e.pendingExpirationDate?s("NcActionInput",{staticClass:"share-link-expire-date",attrs:{disabled:e.saving,"is-native-picker":!0,"hide-label":!0,value:new Date(e.share.expireDate),type:"date",min:e.dateTomorrow,max:e.maxExpirationDateEnforced},on:{input:e.onExpirationChange}},[e._v(" "+e._s(e.t("files_sharing","Enter a date"))+" ")]):e._e(),s("NcActionButton",{on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("CheckIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2630571749)},[e._v(" "+e._s(e.t("files_sharing","Create share"))+" ")]),s("NcActionButton",{on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onCancel.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("CloseIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2428343285)},[e._v(" "+e._s(e.t("files_sharing","Cancel"))+" ")])],1):e.loading?s("div",{staticClass:"icon-loading-small sharing-entry__loading"}):s("NcActions",{staticClass:"sharing-entry__actions",attrs:{"aria-label":e.actionsTooltip,"menu-align":"right",open:e.open},on:{"update:open":function(i){e.open=i},close:e.onMenuClose}},[e.share?[e.share.canEdit&&e.canReshare?[s("NcActionButton",{attrs:{disabled:e.saving,"close-after-click":!0},on:{click:function(i){return i.preventDefault(),e.openSharingDetails.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("Tune",{attrs:{size:20}})]},proxy:!0}],null,!1,1300586850)},[e._v(" "+e._s(e.t("files_sharing","Customize link"))+" ")])]:e._e(),s("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(i){i.preventDefault(),e.showQRCode=!0}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("IconQr",{attrs:{size:20}})]},proxy:!0}],null,!1,1082198240)},[e._v(" "+e._s(e.t("files_sharing","Generate QR code"))+" ")]),s("NcActionSeparator"),e._l(e.externalLinkActions,function(i){return s("ExternalShareAction",{key:i.id,attrs:{id:i.id,action:i,"file-info":e.fileInfo,share:e.share}})}),e._l(e.externalLegacyLinkActions,function({icon:i,url:r,name:a},n){return s("NcActionLink",{key:n,attrs:{href:r(e.shareLink),icon:i,target:"_blank"}},[e._v(" "+e._s(a)+" ")])}),!e.isEmailShareType&&e.canReshare?s("NcActionButton",{staticClass:"new-share-link",on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("PlusIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2953566425)},[e._v(" "+e._s(e.t("files_sharing","Add another link"))+" ")]):e._e(),e.share.canDelete?s("NcActionButton",{attrs:{disabled:e.saving},on:{click:function(i){return i.preventDefault(),e.onDelete.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("CloseIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,2428343285)},[e._v(" "+e._s(e.t("files_sharing","Unshare"))+" ")]):e._e()]:e.canReshare?s("NcActionButton",{staticClass:"new-share-link",attrs:{title:e.t("files_sharing","Create a new share link"),"aria-label":e.t("files_sharing","Create a new share link"),icon:e.loading?"icon-loading-small":"icon-add"},on:{click:function(i){return i.preventDefault(),i.stopPropagation(),e.onNewLinkShare.apply(null,arguments)}}}):e._e()],2),e.showQRCode?s("NcDialog",{attrs:{size:"normal",open:e.showQRCode,name:e.title,"close-on-click-outside":!0},on:{"update:open":function(i){e.showQRCode=i},close:function(i){e.showQRCode=!1}}},[s("div",{staticClass:"qr-code-dialog"},[s("VueQrcode",{staticClass:"qr-code-dialog__img",attrs:{tag:"img",value:e.shareLink}})],1)]):e._e()],1)},Vs=[],zs=A(qs,js,Vs,!1,null,"775e3d14");const Gs=zs.exports,Qs={name:"SharingLinkList",components:{SharingEntryLink:Gs},mixins:[H,$],props:{fileInfo:{type:Object,default:()=>{},required:!0},shares:{type:Array,default:()=>[],required:!0},canReshare:{type:Boolean,required:!0}},data(){return{canLinkShare:z().files_sharing.public.enabled}},computed:{hasLinkShares(){return this.shares.filter(e=>e.type===this.SHARE_TYPES.SHARE_TYPE_LINK).length>0},hasShares(){return this.shares.length>0}},methods:{addShare(e,s){this.shares.unshift(e),this.awaitForShare(e,s)},awaitForShare(e,s){this.$nextTick(()=>{const i=this.$children.find(r=>r.share===e);i&&s(i)})},removeShare(e){const s=this.shares.findIndex(i=>i===e);this.shares.splice(s,1)}}};var Ks=function(){var e=this,s=e._self._c;return e.canLinkShare?s("ul",{staticClass:"sharing-link-list"},[!e.hasLinkShares&&e.canReshare?s("SharingEntryLink",{attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo},on:{"add:share":e.addShare}}):e._e(),e.hasShares?e._l(e.shares,function(i,r){return s("SharingEntryLink",{key:i.id,attrs:{index:e.shares.length>1?r+1:null,"can-reshare":e.canReshare,share:e.shares[r],"file-info":e.fileInfo},on:{"update:share":[function(a){return e.$set(e.shares,r,a)},function(a){return e.awaitForShare(...arguments)}],"add:share":function(a){return e.addShare(...arguments)},"remove:share":e.removeShare,"open-sharing-details":function(a){return e.openSharingDetails(i)}}})}):e._e()],2):e._e()},Js=[],Xs=A(Qs,Ks,Js,!1,null,null);const Zs=Xs.exports,ei={name:"SharingEntry",components:{NcButton:Le,NcAvatar:O,DotsHorizontalIcon:Fe,NcSelect:_e,SharingEntryQuickShareSelect:je},mixins:[K,$],computed:{title(){let e=this.share.shareWithDisplayName;return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP?e+=" (".concat(t("files_sharing","group"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_ROOM?e+=" (".concat(t("files_sharing","conversation"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE?e+=" (".concat(t("files_sharing","remote"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP?e+=" (".concat(t("files_sharing","remote group"),")"):this.share.type===this.SHARE_TYPES.SHARE_TYPE_GUEST&&(e+=" (".concat(t("files_sharing","guest"),")")),e},tooltip(){if(this.share.owner!==this.share.uidFileOwner){const e={user:this.share.shareWithDisplayName,owner:this.share.ownerDisplayName};return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP?t("files_sharing","Shared with the group {user} by {owner}",e):this.share.type===this.SHARE_TYPES.SHARE_TYPE_ROOM?t("files_sharing","Shared with the conversation {user} by {owner}",e):t("files_sharing","Shared with {user} by {owner}",e)}return null},hasStatus(){return this.share.type!==this.SHARE_TYPES.SHARE_TYPE_USER?!1:typeof this.share.status=="object"&&!Array.isArray(this.share.status)}},methods:{onMenuClose(){this.onNoteSubmit()}}};var ti=function(){var e=this,s=e._self._c;return s("li",{staticClass:"sharing-entry"},[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":e.share.type!==e.SHARE_TYPES.SHARE_TYPE_USER,user:e.share.shareWith,"display-name":e.share.shareWithDisplayName,"menu-position":"left",url:e.share.shareWithAvatar}}),s("div",{staticClass:"sharing-entry__summary"},[s(e.share.shareWithLink?"a":"div",{tag:"component",staticClass:"sharing-entry__summary__desc",attrs:{title:e.tooltip,"aria-label":e.tooltip,href:e.share.shareWithLink}},[s("span",[e._v(e._s(e.title)+" "),e.isUnique?e._e():s("span",{staticClass:"sharing-entry__summary__desc-unique"},[e._v(" ("+e._s(e.share.shareWithDisplayNameUnique)+")")]),e.hasStatus&&e.share.status.message?s("small",[e._v("("+e._s(e.share.status.message)+")")]):e._e()])]),s("SharingEntryQuickShareSelect",{attrs:{share:e.share,"file-info":e.fileInfo},on:{"open-sharing-details":function(i){return e.openShareDetailsForCustomSettings(e.share)}}})],1),s("NcButton",{staticClass:"sharing-entry__action",attrs:{"data-cy-files-sharing-share-actions":"","aria-label":e.t("files_sharing","Open Sharing Details"),type:"tertiary"},on:{click:function(i){return e.openSharingDetails(e.share)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DotsHorizontalIcon",{attrs:{size:20}})]},proxy:!0}])})],1)},si=[],ii=A(ei,ti,si,!1,null,"2133984c");const ri=ii.exports,ai={name:"SharingList",components:{SharingEntry:ri},mixins:[H,$],props:{fileInfo:{type:Object,default:()=>{},required:!0},shares:{type:Array,default:()=>[],required:!0}},computed:{hasShares(){return this.shares.length===0},isUnique(){return e=>[...this.shares].filter(s=>e.type===this.SHARE_TYPES.SHARE_TYPE_USER&&e.shareWithDisplayName===s.shareWithDisplayName).length<=1}}};var ni=function(){var e=this,s=e._self._c;return s("ul",{staticClass:"sharing-sharee-list"},e._l(e.shares,function(i){return s("SharingEntry",{key:i.id,attrs:{"file-info":e.fileInfo,share:i,"is-unique":e.isUnique(i)},on:{"open-sharing-details":function(r){return e.openSharingDetails(i)}}})}),1)},oi=[],hi=A(ai,ni,oi,!1,null,null);const li=hi.exports,ci={name:"SharingDetailsTab",components:{NcAvatar:O,NcButton:Le,NcInputField:Xe,NcPasswordField:Ze,NcDateTimePickerNative:et,NcCheckboxRadioSwitch:tt,NcLoadingIcon:st,CloseIcon:Me,CircleIcon:we,EditIcon:Ye,ExternalShareAction:Ve,LinkIcon:Pe,GroupIcon:ve,ShareIcon:Z,UserIcon:be,UploadIcon:pt,ViewIcon:ft,MenuDownIcon:gt,MenuUpIcon:_t,DotsHorizontalIcon:Fe},mixins:[H,Ee,K],props:{shareRequestValue:{type:Object,required:!1},fileInfo:{type:Object,required:!0},share:{type:Object,required:!0}},data(){return{writeNoteToRecipientIsChecked:!1,sharingPermission:w.ALL.toString(),revertSharingPermission:w.ALL.toString(),setCustomPermissions:!1,passwordError:!1,advancedSectionAccordionExpanded:!1,bundledPermissions:w,isFirstComponentLoad:!0,test:!1,creating:!1,ExternalShareActions:OCA.Sharing.ExternalShareActions.state}},computed:{title(){switch(this.share.type){case this.SHARE_TYPES.SHARE_TYPE_USER:return t("files_sharing","Share with {userName}",{userName:this.share.shareWithDisplayName});case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return t("files_sharing","Share with email {email}",{email:this.share.shareWith});case this.SHARE_TYPES.SHARE_TYPE_LINK:return t("files_sharing","Share link");case this.SHARE_TYPES.SHARE_TYPE_GROUP:return t("files_sharing","Share with group");case this.SHARE_TYPES.SHARE_TYPE_ROOM:return t("files_sharing","Share in conversation");case this.SHARE_TYPES.SHARE_TYPE_REMOTE:{const[e,s]=this.share.shareWith.split("@");return t("files_sharing","Share with {user} on remote server {server}",{user:e,server:s})}case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:return t("files_sharing","Share with remote group");case this.SHARE_TYPES.SHARE_TYPE_GUEST:return t("files_sharing","Share with guest");default:return this.share.id?t("files_sharing","Update share"):t("files_sharing","Create share")}},canEdit:{get(){return this.share.hasUpdatePermission},set(e){this.updateAtomicPermissions({isEditChecked:e})}},canCreate:{get(){return this.share.hasCreatePermission},set(e){this.updateAtomicPermissions({isCreateChecked:e})}},canDelete:{get(){return this.share.hasDeletePermission},set(e){this.updateAtomicPermissions({isDeleteChecked:e})}},canReshare:{get(){return this.share.hasSharePermission},set(e){this.updateAtomicPermissions({isReshareChecked:e})}},canDownload:{get(){var e;return((e=this.share.attributes.find(s=>s.key==="download"))==null?void 0:e.enabled)||!1},set(e){const s=this.share.attributes.find(i=>i.key==="download");s&&(s.enabled=e)}},hasRead:{get(){return this.share.hasReadPermission},set(e){this.updateAtomicPermissions({isReadChecked:e})}},hasExpirationDate:{get(){return this.isValidShareAttribute(this.share.expireDate)},set(e){this.share.expireDate=e?this.formatDateToString(this.defaultExpiryDate):""}},isPasswordProtected:{get(){return this.config.enforcePasswordForPublicLink||!!this.share.password},async set(e){e?(this.share.password=await Q(),this.$set(this.share,"newPassword",this.share.password)):(this.share.password="",this.$delete(this.share,"newPassword"))}},isFolder(){return this.fileInfo.type==="dir"},isSetDownloadButtonVisible(){const e=["application/msword","application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.ms-powerpoint","application/vnd.openxmlformats-officedocument.presentationml.presentation","application/vnd.ms-excel","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.spreadsheet","application/vnd.oasis.opendocument.presentation"];return this.isFolder||e.includes(this.fileInfo.mimetype)},isPasswordEnforced(){return this.isPublicShare&&this.config.enforcePasswordForPublicLink},defaultExpiryDate(){return(this.isGroupShare||this.isUserShare)&&this.config.isDefaultInternalExpireDateEnabled?new Date(this.config.defaultInternalExpirationDate):this.isRemoteShare&&this.config.isDefaultRemoteExpireDateEnabled?new Date(this.config.defaultRemoteExpireDateEnabled):this.isPublicShare&&this.config.isDefaultExpireDateEnabled?new Date(this.config.defaultExpirationDate):new Date(new Date().setDate(new Date().getDate()+1))},isUserShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_USER},isGroupShare(){return this.share.type===this.SHARE_TYPES.SHARE_TYPE_GROUP},isNewShare(){return!this.share.id},allowsFileDrop(){return!!(this.isFolder&&this.config.isPublicUploadEnabled&&(this.share.type===this.SHARE_TYPES.SHARE_TYPE_LINK||this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL))},hasFileDropPermissions(){return this.share.permissions===this.bundledPermissions.FILE_DROP},shareButtonText(){return this.isNewShare?t("files_sharing","Save share"):t("files_sharing","Update share")},canSetEdit(){return this.fileInfo.sharePermissions&OC.PERMISSION_UPDATE||this.canEdit},canSetCreate(){return this.fileInfo.sharePermissions&OC.PERMISSION_CREATE||this.canCreate},canSetDelete(){return this.fileInfo.sharePermissions&OC.PERMISSION_DELETE||this.canDelete},canSetReshare(){return this.fileInfo.sharePermissions&OC.PERMISSION_SHARE||this.canReshare},canSetDownload(){return this.fileInfo.canDownload()||this.canDownload},hasUnsavedPassword(){return this.share.newPassword!==void 0},passwordExpirationTime(){if(!this.isValidShareAttribute(this.share.passwordExpirationTime))return null;const e=moment(this.share.passwordExpirationTime);return e.diff(moment())<0?!1:e.fromNow()},isTalkEnabled(){return OC.appswebroots.spreed!==void 0},isPasswordProtectedByTalkAvailable(){return this.isPasswordProtected&&this.isTalkEnabled},isPasswordProtectedByTalk:{get(){return this.share.sendPasswordByTalk},async set(e){this.share.sendPasswordByTalk=e}},isEmailShareType(){return this.share?this.share.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL:!1},canTogglePasswordProtectedByTalkAvailable(){return!this.isPublicShare||!this.isPasswordProtected||this.isEmailShareType&&!this.hasUnsavedPassword?!1:OC.appswebroots.spreed!==void 0},canChangeHideDownload(){const e=s=>s.key==="download"&&s.scope==="permissions"&&s.enabled===!1;return this.fileInfo.shareAttributes.some(e)},customPermissionsList(){const e={[f.READ]:this.t("files_sharing","Read"),[f.CREATE]:this.t("files_sharing","Create"),[f.UPDATE]:this.t("files_sharing","Edit"),[f.SHARE]:this.t("files_sharing","Share"),[f.DELETE]:this.t("files_sharing","Delete")};return[f.READ,f.CREATE,f.UPDATE,f.SHARE,f.DELETE].filter(s=>Ts(this.share.permissions,s)).map((s,i)=>i===0?e[s]:e[s].toLocaleLowerCase(it())).join(", ")},advancedControlExpandedValue(){return this.advancedSectionAccordionExpanded?"true":"false"},errorPasswordLabel(){if(this.passwordError)return t("files_sharing","Password field can't be empty")},externalLinkActions(){const e=s=>(s.shareType.includes(C.SHARE_TYPE_LINK)||s.shareType.includes(C.SHARE_TYPE_EMAIL))&&s.advanced;return this.ExternalShareActions.actions.filter(e)}},watch:{setCustomPermissions(e){e?this.sharingPermission="custom":this.sharingPermission=this.revertSharingPermission}},beforeMount(){this.initializePermissions(),this.initializeAttributes(),console.debug("shareSentIn",this.share),console.debug("config",this.config)},mounted(){var e,s;(s=(e=this.$refs.quickPermissions)==null?void 0:e.querySelector("input:checked"))==null||s.focus()},methods:{updateAtomicPermissions({isReadChecked:e=this.hasRead,isEditChecked:s=this.canEdit,isCreateChecked:i=this.canCreate,isDeleteChecked:r=this.canDelete,isReshareChecked:a=this.canReshare}={}){const n=0|(e?f.READ:0)|(i?f.CREATE:0)|(r?f.DELETE:0)|(s?f.UPDATE:0)|(a?f.SHARE:0);this.share.permissions=n},expandCustomPermissions(){this.advancedSectionAccordionExpanded||(this.advancedSectionAccordionExpanded=!0),this.toggleCustomPermissions()},toggleCustomPermissions(e){const s=this.sharingPermission==="custom";this.revertSharingPermission=s?"custom":e,this.setCustomPermissions=s},async initializeAttributes(){if(this.isNewShare){this.isPasswordEnforced&&this.isPublicShare&&(this.$set(this.share,"newPassword",await Q()),this.advancedSectionAccordionExpanded=!0),this.isPublicShare&&this.config.isDefaultExpireDateEnabled?this.share.expireDate=this.config.defaultExpirationDate.toDateString():this.isRemoteShare&&this.config.isDefaultRemoteExpireDateEnabled?this.share.expireDate=this.config.defaultRemoteExpirationDateString.toDateString():this.config.isDefaultInternalExpireDateEnabled&&(this.share.expireDate=this.config.defaultInternalExpirationDate.toDateString()),this.isValidShareAttribute(this.share.expireDate)&&(this.advancedSectionAccordionExpanded=!0);return}!this.isValidShareAttribute(this.share.expireDate)&&this.isExpiryDateEnforced&&(this.hasExpirationDate=!0),(this.isValidShareAttribute(this.share.password)||this.isValidShareAttribute(this.share.expireDate)||this.isValidShareAttribute(this.share.label))&&(this.advancedSectionAccordionExpanded=!0)},handleShareType(){"shareType"in this.share?this.share.type=this.share.shareType:this.share.share_type&&(this.share.type=this.share.share_type)},handleDefaultPermissions(){if(this.isNewShare){const e=this.config.defaultPermissions;e===w.READ_ONLY||e===w.ALL?this.sharingPermission=e.toString():(this.sharingPermission="custom",this.share.permissions=e,this.advancedSectionAccordionExpanded=!0,this.setCustomPermissions=!0)}},handleCustomPermissions(){!this.isNewShare&&(this.hasCustomPermissions||this.share.setCustomPermissions)?(this.sharingPermission="custom",this.advancedSectionAccordionExpanded=!0,this.setCustomPermissions=!0):this.share.permissions&&(this.sharingPermission=this.share.permissions.toString())},initializePermissions(){this.handleShareType(),this.handleDefaultPermissions(),this.handleCustomPermissions()},async saveShare(){var r;const e=["permissions","attributes","note","expireDate"],s=["label","password","hideDownload"];this.isPublicShare&&e.push(...s);const i=parseInt(this.sharingPermission);if(this.setCustomPermissions?this.updateAtomicPermissions():this.share.permissions=i,!this.isFolder&&this.share.permissions===w.ALL&&(this.share.permissions=w.ALL_FILE),this.writeNoteToRecipientIsChecked||(this.share.note=""),this.isPasswordProtected?this.hasUnsavedPassword&&this.isValidShareAttribute(this.share.newPassword)?(this.share.password=this.share.newPassword,this.$delete(this.share,"newPassword")):this.isPasswordEnforced&&!this.isValidShareAttribute(this.share.password)&&(this.passwordError=!0):this.share.password="",this.hasExpirationDate||(this.share.expireDate=""),this.isNewShare){const a={permissions:this.share.permissions,shareType:this.share.type,shareWith:this.share.shareWith,attributes:this.share.attributes,note:this.share.note,fileInfo:this.fileInfo};a.expireDate=this.hasExpirationDate?this.share.expireDate:"",this.isPasswordProtected&&(a.password=this.share.password),this.creating=!0;const n=await this.addShare(a,this.fileInfo);this.creating=!1,this.share=n,this.$emit("add:share",this.share)}else this.queueUpdate(...e);((r=this.$refs.externalLinkActions)==null?void 0:r.length)>0&&await Promise.allSettled(this.$refs.externalLinkActions.map(a=>{var n,l,h;return typeof((n=a.$children.at(0))==null?void 0:n.onSave)!="function"?Promise.resolve():(h=(l=a.$children.at(0))==null?void 0:l.onSave)==null?void 0:h.call(l)})),this.$emit("close-sharing-details")},async addShare(e,s){console.debug("Adding a new share from the input for",e);try{const i=(s.path+"/"+s.name).replace("//","/");return await this.createShare({path:i,shareType:e.shareType,shareWith:e.shareWith,permissions:e.permissions,expireDate:e.expireDate,attributes:JSON.stringify(e.attributes),...e.note?{note:e.note}:{},...e.password?{password:e.password}:{}})}catch(i){console.error("Error while adding new share",i)}finally{}},async removeShare(){await this.onDelete(),this.$emit("close-sharing-details")},onPasswordChange(e){this.passwordError=!this.isValidShareAttribute(e),this.$set(this.share,"newPassword",e)},onPasswordProtectedByTalkChange(){this.hasUnsavedPassword&&(this.share.password=this.share.newPassword.trim()),this.queueUpdate("sendPasswordByTalk","password")},isValidShareAttribute(e){return!([null,void 0].includes(e)||!(e.trim().length>0))},getShareTypeIcon(e){switch(e){case this.SHARE_TYPES.SHARE_TYPE_LINK:return Pe;case this.SHARE_TYPES.SHARE_TYPE_GUEST:return be;case this.SHARE_TYPES.SHARE_TYPE_REMOTE_GROUP:case this.SHARE_TYPES.SHARE_TYPE_GROUP:return ve;case this.SHARE_TYPES.SHARE_TYPE_EMAIL:return mt;case this.SHARE_TYPES.SHARE_TYPE_CIRCLE:return we;case this.SHARE_TYPES.SHARE_TYPE_ROOM:return Z;case this.SHARE_TYPES.SHARE_TYPE_DECK:return Z;case this.SHARE_TYPES.SHARE_TYPE_SCIENCEMESH:return Z;default:return null}}}};var di=function(){var i;var e=this,s=e._self._c;return s("div",{staticClass:"sharingTabDetailsView"},[s("div",{staticClass:"sharingTabDetailsView__header"},[s("span",[e.isUserShare?s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{"is-no-user":e.share.shareType!==e.SHARE_TYPES.SHARE_TYPE_USER,user:e.share.shareWith,"display-name":e.share.shareWithDisplayName,"menu-position":"left",url:e.share.shareWithAvatar}}):e._e(),s(e.getShareTypeIcon(e.share.type),{tag:"component",attrs:{size:32}})],1),s("span",[s("h1",[e._v(e._s(e.title))])])]),s("div",{staticClass:"sharingTabDetailsView__wrapper"},[s("div",{ref:"quickPermissions",staticClass:"sharingTabDetailsView__quick-permissions"},[s("div",[s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,"data-cy-files-sharing-share-permissions-bundle":"read-only",checked:e.sharingPermission,value:e.bundledPermissions.READ_ONLY.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("ViewIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","View only"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,"data-cy-files-sharing-share-permissions-bundle":"upload-edit",checked:e.sharingPermission,value:e.bundledPermissions.ALL.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("EditIcon",{attrs:{size:20}})]},proxy:!0}])},[e.allowsFileDrop?[e._v(" "+e._s(e.t("files_sharing","Allow upload and editing"))+" ")]:[e._v(" "+e._s(e.t("files_sharing","Allow editing"))+" ")]],2),e.allowsFileDrop?s("NcCheckboxRadioSwitch",{attrs:{"data-cy-files-sharing-share-permissions-bundle":"file-drop","button-variant":!0,checked:e.sharingPermission,value:e.bundledPermissions.FILE_DROP.toString(),name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.toggleCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("UploadIcon",{attrs:{size:20}})]},proxy:!0}],null,!1,1083194048)},[e._v(" "+e._s(e.t("files_sharing","File drop"))+" "),s("small",{staticClass:"subline"},[e._v(e._s(e.t("files_sharing","Upload only")))])]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{"button-variant":!0,"data-cy-files-sharing-share-permissions-bundle":"custom",checked:e.sharingPermission,value:"custom",name:"sharing_permission_radio",type:"radio","button-variant-grouped":"vertical"},on:{"update:checked":[function(r){e.sharingPermission=r},e.expandCustomPermissions]},scopedSlots:e._u([{key:"icon",fn:function(){return[s("DotsHorizontalIcon",{attrs:{size:20}})]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","Custom permissions"))+" "),s("small",{staticClass:"subline"},[e._v(e._s(e.customPermissionsList))])])],1)]),s("div",{staticClass:"sharingTabDetailsView__advanced-control"},[s("NcButton",{attrs:{id:"advancedSectionAccordionAdvancedControl",type:"tertiary",alignment:"end-reverse","aria-controls":"advancedSectionAccordionAdvanced","aria-expanded":e.advancedControlExpandedValue},on:{click:function(r){e.advancedSectionAccordionExpanded=!e.advancedSectionAccordionExpanded}},scopedSlots:e._u([{key:"icon",fn:function(){return[e.advancedSectionAccordionExpanded?s("MenuUpIcon"):s("MenuDownIcon")]},proxy:!0}])},[e._v(" "+e._s(e.t("files_sharing","Advanced settings"))+" ")])],1),e.advancedSectionAccordionExpanded?s("div",{staticClass:"sharingTabDetailsView__advanced",attrs:{id:"advancedSectionAccordionAdvanced","aria-labelledby":"advancedSectionAccordionAdvancedControl",role:"region"}},[s("section",[e.isPublicShare?s("NcInputField",{attrs:{autocomplete:"off",label:e.t("files_sharing","Share label"),value:e.share.label},on:{"update:value":function(r){return e.$set(e.share,"label",r)}}}):e._e(),e.isPublicShare?[s("NcCheckboxRadioSwitch",{attrs:{checked:e.isPasswordProtected,disabled:e.isPasswordEnforced},on:{"update:checked":function(r){e.isPasswordProtected=r}}},[e._v(" "+e._s(e.t("files_sharing","Set password"))+" ")]),e.isPasswordProtected?s("NcPasswordField",{attrs:{autocomplete:"new-password",value:e.hasUnsavedPassword?e.share.newPassword:"",error:e.passwordError,"helper-text":e.errorPasswordLabel,required:e.isPasswordEnforced,label:e.t("files_sharing","Password")},on:{"update:value":e.onPasswordChange}}):e._e(),e.isEmailShareType&&e.passwordExpirationTime?s("span",{attrs:{icon:"icon-info"}},[e._v(" "+e._s(e.t("files_sharing","Password expires {passwordExpirationTime}",{passwordExpirationTime:e.passwordExpirationTime}))+" ")]):e.isEmailShareType&&e.passwordExpirationTime!==null?s("span",{attrs:{icon:"icon-error"}},[e._v(" "+e._s(e.t("files_sharing","Password expired"))+" ")]):e._e()]:e._e(),e.canTogglePasswordProtectedByTalkAvailable?s("NcCheckboxRadioSwitch",{attrs:{checked:e.isPasswordProtectedByTalk},on:{"update:checked":[function(r){e.isPasswordProtectedByTalk=r},e.onPasswordProtectedByTalkChange]}},[e._v(" "+e._s(e.t("files_sharing","Video verification"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{checked:e.hasExpirationDate,disabled:e.isExpiryDateEnforced},on:{"update:checked":function(r){e.hasExpirationDate=r}}},[e._v(" "+e._s(e.isExpiryDateEnforced?e.t("files_sharing","Expiration date (enforced)"):e.t("files_sharing","Set expiration date"))+" ")]),e.hasExpirationDate?s("NcDateTimePickerNative",{attrs:{id:"share-date-picker",value:new Date((i=e.share.expireDate)!=null?i:e.dateTomorrow),min:e.dateTomorrow,max:e.maxExpirationDateEnforced,"hide-label":!0,placeholder:e.t("files_sharing","Expiration date"),type:"date"},on:{input:e.onExpirationChange}}):e._e(),e.isPublicShare?s("NcCheckboxRadioSwitch",{attrs:{disabled:e.canChangeHideDownload,checked:e.share.hideDownload},on:{"update:checked":[function(r){return e.$set(e.share,"hideDownload",r)},function(r){return e.queueUpdate("hideDownload")}]}},[e._v(" "+e._s(e.t("files_sharing","Hide download"))+" ")]):e._e(),e.isPublicShare?e._e():s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetDownload,checked:e.canDownload,"data-cy-files-sharing-share-permissions-checkbox":"download"},on:{"update:checked":function(r){e.canDownload=r}}},[e._v(" "+e._s(e.t("files_sharing","Allow download"))+" ")]),s("NcCheckboxRadioSwitch",{attrs:{checked:e.writeNoteToRecipientIsChecked},on:{"update:checked":function(r){e.writeNoteToRecipientIsChecked=r}}},[e._v(" "+e._s(e.t("files_sharing","Note to recipient"))+" ")]),e.writeNoteToRecipientIsChecked?[s("label",{attrs:{for:"share-note-textarea"}},[e._v(" "+e._s(e.t("files_sharing","Enter a note for the share recipient"))+" ")]),s("textarea",{attrs:{id:"share-note-textarea"},domProps:{value:e.share.note},on:{input:function(r){e.share.note=r.target.value}}})]:e._e(),e._l(e.externalLinkActions,function(r){return s("ExternalShareAction",{key:r.id,ref:"externalLinkActions",refInFor:!0,attrs:{id:r.id,action:r,"file-info":e.fileInfo,share:e.share}})}),s("NcCheckboxRadioSwitch",{attrs:{checked:e.setCustomPermissions},on:{"update:checked":function(r){e.setCustomPermissions=r}}},[e._v(" "+e._s(e.t("files_sharing","Custom permissions"))+" ")]),e.setCustomPermissions?s("section",{staticClass:"custom-permissions-group"},[s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.allowsFileDrop&&e.share.type===e.SHARE_TYPES.SHARE_TYPE_LINK,checked:e.hasRead,"data-cy-files-sharing-share-permissions-checkbox":"read"},on:{"update:checked":function(r){e.hasRead=r}}},[e._v(" "+e._s(e.t("files_sharing","Read"))+" ")]),e.isFolder?s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetCreate,checked:e.canCreate,"data-cy-files-sharing-share-permissions-checkbox":"create"},on:{"update:checked":function(r){e.canCreate=r}}},[e._v(" "+e._s(e.t("files_sharing","Create"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetEdit,checked:e.canEdit,"data-cy-files-sharing-share-permissions-checkbox":"update"},on:{"update:checked":function(r){e.canEdit=r}}},[e._v(" "+e._s(e.t("files_sharing","Edit"))+" ")]),e.config.isResharingAllowed&&e.share.type!==e.SHARE_TYPES.SHARE_TYPE_LINK?s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetReshare,checked:e.canReshare,"data-cy-files-sharing-share-permissions-checkbox":"share"},on:{"update:checked":function(r){e.canReshare=r}}},[e._v(" "+e._s(e.t("files_sharing","Share"))+" ")]):e._e(),s("NcCheckboxRadioSwitch",{attrs:{disabled:!e.canSetDelete,checked:e.canDelete,"data-cy-files-sharing-share-permissions-checkbox":"delete"},on:{"update:checked":function(r){e.canDelete=r}}},[e._v(" "+e._s(e.t("files_sharing","Delete"))+" ")])],1):e._e(),s("div",{staticClass:"sharingTabDetailsView__delete"},[e.isNewShare?e._e():s("NcButton",{attrs:{"aria-label":e.t("files_sharing","Delete share"),disabled:!1,readonly:!1,type:"tertiary"},on:{click:function(r){return r.preventDefault(),e.removeShare.apply(null,arguments)}},scopedSlots:e._u([{key:"icon",fn:function(){return[s("CloseIcon",{attrs:{size:16}})]},proxy:!0}],null,!1,2746485232)},[e._v(" "+e._s(e.t("files_sharing","Delete share"))+" ")])],1)],2)]):e._e()]),s("div",{staticClass:"sharingTabDetailsView__footer"},[s("div",{staticClass:"button-group"},[s("NcButton",{attrs:{"data-cy-files-sharing-share-editor-action":"cancel"},on:{click:function(r){return e.$emit("close-sharing-details")}}},[e._v(" "+e._s(e.t("files_sharing","Cancel"))+" ")]),s("NcButton",{attrs:{type:"primary","data-cy-files-sharing-share-editor-action":"save"},on:{click:e.saveShare},scopedSlots:e._u([e.creating?{key:"icon",fn:function(){return[s("NcLoadingIcon")]},proxy:!0}:null],null,!0)},[e._v(" "+e._s(e.shareButtonText)+" ")])],1)])])},ui=[],pi=A(ci,di,ui,!1,null,"aa347987");const fi=pi.exports,gi={name:"SharingTab",components:{NcAvatar:O,CollectionList:ls,SharingEntryInternal:Es,SharingEntrySimple:ae,SharingInherited:Os,SharingInput:bs,SharingLinkList:Zs,SharingList:li,SharingDetailsTab:fi},mixins:[H],data(){return{config:new re,deleteEvent:null,error:"",expirationInterval:null,loading:!0,fileInfo:null,reshare:null,sharedWithMe:{},shares:[],linkShares:[],sections:OCA.Sharing.ShareTabSections.getSections(),projectsEnabled:rt("core","projects_enabled",!1),showSharingDetailsView:!1,shareDetailsData:{},returnFocusElement:null}},computed:{isSharedWithMe(){return Object.keys(this.sharedWithMe).length>0},canReshare(){return!!(this.fileInfo.permissions&OC.PERMISSION_SHARE)||!!(this.reshare&&this.reshare.hasSharePermission&&this.config.isResharingAllowed)}},methods:{async update(e){this.fileInfo=e,this.resetState(),this.getShares()},async getShares(){var e,s,i;try{this.loading=!0;const r=G("apps/files_sharing/api/v1/shares"),a="json",n=(this.fileInfo.path+"/"+this.fileInfo.name).replace("//","/"),l=I.get(r,{params:{format:a,path:n,reshares:!0}}),h=I.get(r,{params:{format:a,path:n,shared_with_me:!0}}),[_,g]=await Promise.all([l,h]);this.loading=!1,this.processSharedWithMe(g),this.processShares(_)}catch(r){(i=(s=(e=r.response.data)==null?void 0:e.ocs)==null?void 0:s.meta)!=null&&i.message?this.error=r.response.data.ocs.meta.message:this.error=t("files_sharing","Unable to load the shares list"),this.loading=!1,console.error("Error loading the shares list",r)}},resetState(){clearInterval(this.expirationInterval),this.loading=!0,this.error="",this.sharedWithMe={},this.shares=[],this.linkShares=[],this.showSharingDetailsView=!1,this.shareDetailsData={}},updateExpirationSubtitle(e){const s=moment(e.expireDate).unix();this.$set(this.sharedWithMe,"subtitle",t("files_sharing","Expires {relativetime}",{relativetime:OC.Util.relativeModifiedDate(s*1e3)})),moment().unix()>s&&(clearInterval(this.expirationInterval),this.$set(this.sharedWithMe,"subtitle",t("files_sharing","this share just expired.")))},processShares({data:e}){if(e.ocs&&e.ocs.data&&e.ocs.data.length>0){const s=e.ocs.data.map(i=>new T(i)).sort((i,r)=>r.createdTime-i.createdTime);this.linkShares=s.filter(i=>i.type===this.SHARE_TYPES.SHARE_TYPE_LINK||i.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL),this.shares=s.filter(i=>i.type!==this.SHARE_TYPES.SHARE_TYPE_LINK&&i.type!==this.SHARE_TYPES.SHARE_TYPE_EMAIL),console.debug("Processed",this.linkShares.length,"link share(s)"),console.debug("Processed",this.shares.length,"share(s)")}},processSharedWithMe({data:e}){if(e.ocs&&e.ocs.data&&e.ocs.data[0]){const s=new T(e),i=cs(s),r=s.ownerDisplayName,a=s.owner;this.sharedWithMe={displayName:r,title:i,user:a},this.reshare=s,s.expireDate&&moment(s.expireDate).unix()>moment().unix()&&(this.updateExpirationSubtitle(s),this.expirationInterval=setInterval(this.updateExpirationSubtitle,1e4,s))}else this.fileInfo&&this.fileInfo.shareOwnerId!==void 0&&this.fileInfo.shareOwnerId!==OC.currentUser&&(this.sharedWithMe={displayName:this.fileInfo.shareOwner,title:t("files_sharing","Shared with you by {owner}",{owner:this.fileInfo.shareOwner},void 0,{escape:!1}),user:this.fileInfo.shareOwnerId})},addShare(e,s=()=>{}){e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL?this.linkShares.unshift(e):this.shares.unshift(e),this.awaitForShare(e,s)},removeShare(e){const s=e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL||e.type===this.SHARE_TYPES.SHARE_TYPE_LINK?this.linkShares:this.shares,i=s.findIndex(r=>r.id===e.id);i!==-1&&s.splice(i,1)},awaitForShare(e,s){this.$nextTick(()=>{let i=this.$refs.shareList;e.type===this.SHARE_TYPES.SHARE_TYPE_EMAIL&&(i=this.$refs.linkShareList);const r=i.$children.find(a=>a.share===e);r&&s(r)})},toggleShareDetailsView(e){var s;if(!this.showSharingDetailsView)if(Array.from(document.activeElement.classList).some(i=>i.startsWith("action-"))){const i=(s=document.activeElement.closest('[role="menu"]'))==null?void 0:s.id;this.returnFocusElement=document.querySelector('[aria-controls="'.concat(i,'"]'))}else this.returnFocusElement=document.activeElement;e&&(this.shareDetailsData=e),this.showSharingDetailsView=!this.showSharingDetailsView,this.showSharingDetailsView||this.$nextTick(()=>{var i;(i=this.returnFocusElement)==null||i.focus(),this.returnFocusElement=null})}}};var _i=function(){var e=this,s=e._self._c;return s("div",{staticClass:"sharingTab",class:{"icon-loading":e.loading}},[e.error?s("div",{staticClass:"emptycontent",class:{emptyContentWithSections:e.sections.length>0}},[s("div",{staticClass:"icon icon-error"}),s("h2",[e._v(e._s(e.error))])]):e._e(),s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showSharingDetailsView,expression:"!showSharingDetailsView"}],staticClass:"sharingTab__content"},[s("ul",[e.isSharedWithMe?s("SharingEntrySimple",e._b({staticClass:"sharing-entry__reshare",scopedSlots:e._u([{key:"avatar",fn:function(){return[s("NcAvatar",{staticClass:"sharing-entry__avatar",attrs:{user:e.sharedWithMe.user,"display-name":e.sharedWithMe.displayName}})]},proxy:!0}],null,!1,3197855346)},"SharingEntrySimple",e.sharedWithMe,!1)):e._e()],1),e.loading?e._e():s("SharingInput",{attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo,"link-shares":e.linkShares,reshare:e.reshare,shares:e.shares},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.loading?e._e():s("SharingLinkList",{ref:"linkShareList",attrs:{"can-reshare":e.canReshare,"file-info":e.fileInfo,shares:e.linkShares},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.loading?e._e():s("SharingList",{ref:"shareList",attrs:{shares:e.shares,"file-info":e.fileInfo},on:{"open-sharing-details":e.toggleShareDetailsView}}),e.canReshare&&!e.loading?s("SharingInherited",{attrs:{"file-info":e.fileInfo}}):e._e(),s("SharingEntryInternal",{attrs:{"file-info":e.fileInfo}}),e.projectsEnabled&&e.fileInfo?s("CollectionList",{attrs:{id:"".concat(e.fileInfo.id),type:"file",name:e.fileInfo.name}}):e._e()],1),e._l(e.sections,function(i,r){return s("div",{directives:[{name:"show",rawName:"v-show",value:!e.showSharingDetailsView,expression:"!showSharingDetailsView"}],key:r,ref:"section-"+r,refInFor:!0,staticClass:"sharingTab__additionalContent"},[s(i(e.$refs["section-"+r],e.fileInfo),{tag:"component",attrs:{"file-info":e.fileInfo}})],1)}),e.showSharingDetailsView?s("SharingDetailsTab",{attrs:{"file-info":e.shareDetailsData.fileInfo,share:e.shareDetailsData.share},on:{"close-sharing-details":e.toggleShareDetailsView,"add:share":e.addShare,"remove:share":e.removeShare}}):e._e()],2)},mi=[],Si=A(gi,_i,mi,!1,null,"4a9f79ac");const xi=Si.exports;export{xi as default};
