/*! third party licenses: dist/vendor.LICENSE.txt */
import{l as O,k as V,p as Y,V as c,F as w,r as v,D as j,P as T,m as b}from"./chunks/index-CPCGRGcp.mjs";import{aV as k,bY as m,c2 as P,b$ as d,bS as u,bT as t,c6 as S,bR as E,b_ as G}from"./core-common.mjs";import{ap as C,aq as U,ar as N,as as I,ab as z,at as K,au as q,av as Z,aw as $}from"./chunks/icons-DENytzON.mjs";import{T as _}from"./chunks/index-YIotKjSS.mjs";import{a as J}from"./chunks/sidebarAction-CLvoFgmx.mjs";import"./chunks/index-7XKGWWeV.mjs";import"./chunks/index-CFlSzEWv.mjs";import"./chunks/index-BxKJ4nfQ.mjs";import"./chunks/logger-abzvQ-j7.mjs";const Q=k.getLoggerBuilder().setApp("files_sharing").detectUser().build();var x;const A="/files/".concat((x=m())==null?void 0:x.uid),y={"Content-Type":"application/json"},W=function(e){var s;try{const i=(e==null?void 0:e.item_type)==="folder",a=(e==null?void 0:e.has_preview)===!0,n=i?O:V,r=e.file_source,o=(e==null?void 0:e.path)||e.file_target,l=P("dav/".concat(A,"/").concat(o).replaceAll(/\/\//gm,"/"));let h=e!=null&&e.item_mtime?new Date(e.item_mtime*1e3):void 0;return(e==null?void 0:e.stime)>((e==null?void 0:e.item_mtime)||0)&&(h=new Date(e.stime*1e3)),new n({id:r,source:l,owner:e==null?void 0:e.uid_owner,mime:e==null?void 0:e.mimetype,mtime:h,size:e==null?void 0:e.item_size,permissions:(e==null?void 0:e.item_permissions)||(e==null?void 0:e.permissions),root:A,attributes:{...e,"has-preview":a,"owner-id":e==null?void 0:e.uid_owner,"owner-display-name":e==null?void 0:e.displayname_owner,"share-types":e==null?void 0:e.share_type,favorite:(s=e==null?void 0:e.tags)!=null&&s.includes(window.OC.TAG_FAVORITE)?1:0}})}catch(i){return Q.error("Error while parsing OCS entry",{error:i}),null}},H=function(e=!1){const s=d("apps/files_sharing/api/v1/shares");return u.get(s,{headers:y,params:{shared_with_me:e,include_tags:!0}})},X=function(){return H(!0)},ee=function(){return H()},se=function(){const e=d("apps/files_sharing/api/v1/remote_shares");return u.get(e,{headers:y,params:{include_tags:!0}})},ie=function(){const e=d("apps/files_sharing/api/v1/shares/pending");return u.get(e,{headers:y,params:{include_tags:!0}})},re=function(){const e=d("apps/files_sharing/api/v1/remote_shares/pending");return u.get(e,{headers:y,params:{include_tags:!0}})},te=function(){const e=d("apps/files_sharing/api/v1/deletedshares");return u.get(e,{headers:y,params:{include_tags:!0}})},ae=function(e,s){return Object.values(e.reduce(function(i,a){return(i[a[s]]=i[a[s]]||[]).push(a),i},{}))},g=async(e=!0,s=!0,i=!1,a=!1,n=[])=>{var r;const o=[];e&&o.push(X(),se()),s&&o.push(ee()),i&&o.push(ie(),re()),a&&o.push(te());let l=(await Promise.all(o)).map(h=>h.data.ocs.data).flat().map(W).filter(h=>h!==null);return n.length>0&&(l=l.filter(h=>{var f;return n.includes((f=h.attributes)==null?void 0:f.share_type)})),l=ae(l,"source").map(h=>{const f=h[0];return f.attributes["share-types"]=h.map(M=>M.attributes["share-types"]),f}),{folder:new O({id:0,source:P("dav"+A),owner:((r=m())==null?void 0:r.uid)||null}),contents:l}},p="shareoverview",B="sharingin",L="sharingout",D="sharinglinks",F="deletedshares",R="pendingshares",ne=()=>{const e=Y();e.register(new c({id:p,name:t("files_sharing","Shares"),caption:t("files_sharing","Overview of shared files."),emptyTitle:t("files_sharing","No shares"),emptyCaption:t("files_sharing","Files and folders you shared or have been shared with you will show up here"),icon:C,order:20,columns:[],getContents:()=>g()})),e.register(new c({id:B,name:t("files_sharing","Shared with you"),caption:t("files_sharing","List of files that are shared with you."),emptyTitle:t("files_sharing","Nothing shared with you yet"),emptyCaption:t("files_sharing","Files and folders others shared with you will show up here"),icon:U,order:1,parent:p,columns:[],getContents:()=>g(!0,!1,!1,!1)})),e.register(new c({id:L,name:t("files_sharing","Shared with others"),caption:t("files_sharing","List of files that you shared with others."),emptyTitle:t("files_sharing","Nothing shared yet"),emptyCaption:t("files_sharing","Files and folders you shared will show up here"),icon:N,order:2,parent:p,columns:[],getContents:()=>g(!1,!0,!1,!1)})),e.register(new c({id:D,name:t("files_sharing","Shared by link"),caption:t("files_sharing","List of files that are shared by link."),emptyTitle:t("files_sharing","No shared links"),emptyCaption:t("files_sharing","Files and folders you shared by link will show up here"),icon:I,order:3,parent:p,columns:[],getContents:()=>g(!1,!0,!1,!1,[window.OC.Share.SHARE_TYPE_LINK])})),e.register(new c({id:F,name:t("files_sharing","Deleted shares"),caption:t("files_sharing","List of shares you left."),emptyTitle:t("files_sharing","No deleted shares"),emptyCaption:t("files_sharing","Shares you have left will show up here"),icon:z,order:4,parent:p,columns:[],getContents:()=>g(!1,!1,!1,!0)})),e.register(new c({id:R,name:t("files_sharing","Pending shares"),caption:t("files_sharing","List of unapproved shares."),emptyTitle:t("files_sharing","No pending shares"),emptyCaption:t("files_sharing","Shares you have received but not approved will show up here"),icon:K,order:5,parent:p,columns:[],getContents:()=>g(!1,!1,!0,!1)}))},oe=new w({id:"accept-share",displayName:e=>S("files_sharing","Accept share","Accept shares",e.length),iconSvgInline:()=>q,enabled:(e,s)=>e.length>0&&s.id===R,async exec(e){try{const s=!!e.attributes.remote,i=d("apps/files_sharing/api/v1/{shareBase}/pending/{id}",{shareBase:s?"remote_shares":"shares",id:e.attributes.id});return await u.post(i),E("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:1,inline:()=>!0});v(oe);const le=new w({id:"open-in-files",displayName:()=>t("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,s)=>[p,B,L,D].includes(s.id),async exec(e){return window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null},order:-1e3,default:j.HIDDEN});v(le);const he=new w({id:"reject-share",displayName:e=>S("files_sharing","Reject share","Reject shares",e.length),iconSvgInline:()=>Z,enabled:(e,s)=>!(s.id!==R||e.length===0||e.some(i=>i.attributes.remote_id&&i.attributes.share_type===window.OC.Share.SHARE_TYPE_REMOTE_GROUP)),async exec(e){try{const s=!!e.attributes.remote,i=d("apps/files_sharing/api/v1/{shareBase}/{id}",{shareBase:s?"remote_shares":"shares",id:e.attributes.id});return await u.delete(i),E("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:2,inline:()=>!0});v(he);const de=new w({id:"restore-share",displayName:e=>S("files_sharing","Restore share","Restore shares",e.length),iconSvgInline:()=>$,enabled:(e,s)=>e.length>0&&s.id===F,async exec(e){try{const s=d("apps/files_sharing/api/v1/deletedshares/{id}",{id:e.attributes.id});return await u.post(s),E("files:node:deleted",e),!0}catch{return!1}},async execBatch(e,s,i){return Promise.all(e.map(a=>this.exec(a,s,i)))},order:1,inline:()=>!0});v(de);const ue='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,5.5A3.5,3.5 0 0,1 15.5,9A3.5,3.5 0 0,1 12,12.5A3.5,3.5 0 0,1 8.5,9A3.5,3.5 0 0,1 12,5.5M5,8C5.56,8 6.08,8.15 6.53,8.42C6.38,9.85 6.8,11.27 7.66,12.38C7.16,13.34 6.16,14 5,14A3,3 0 0,1 2,11A3,3 0 0,1 5,8M19,8A3,3 0 0,1 22,11A3,3 0 0,1 19,14C17.84,14 16.84,13.34 16.34,12.38C17.2,11.27 17.62,9.85 17.47,8.42C17.92,8.15 18.44,8 19,8M5.5,18.25C5.5,16.18 8.41,14.5 12,14.5C15.59,14.5 18.5,16.18 18.5,18.25V20H5.5V18.25M0,20V18.5C0,17.11 1.89,15.94 4.45,15.6C3.86,16.28 3.5,17.22 3.5,18.25V20H0M24,20H20.5V18.25C20.5,17.22 20.14,16.28 19.55,15.6C22.11,15.94 24,17.11 24,18.5V20Z" /></svg>',pe=e=>{const s=G("/avatar/{userId}/32",{userId:e});return'<svg width="32" height="32" viewBox="0 0 32 32"\n		xmlns="http://www.w3.org/2000/svg" class="sharing-status__avatar">\n		<image href="'.concat(s,'" height="32" width="32" />\n	</svg>')},ce=new w({id:"sharing-status",displayName(e){var s,i,a;const n=e[0],r=Object.values(((s=n==null?void 0:n.attributes)==null?void 0:s["share-types"])||{}).flat(),o=(i=n==null?void 0:n.attributes)==null?void 0:i["owner-id"];return r.length>0||o&&o!==((a=m())==null?void 0:a.uid)?t("files_sharing","Shared"):""},title(e){var s,i,a,n;const r=e[0],o=(s=r==null?void 0:r.attributes)==null?void 0:s["owner-id"],l=(i=r==null?void 0:r.attributes)==null?void 0:i["owner-display-name"];return Array.isArray((a=r.attributes)==null?void 0:a["share-types"])?t("files_sharing","Shared multiple times with different people"):o&&o!==((n=m())==null?void 0:n.uid)?t("files_sharing","Shared by {ownerDisplayName}",{ownerDisplayName:l}):t("files_sharing","Show sharing options")},iconSvgInline(e){var s,i,a,n;const r=e[0],o=Object.values(((s=r==null?void 0:r.attributes)==null?void 0:s["share-types"])||{}).flat();if(Array.isArray((i=r.attributes)==null?void 0:i["share-types"]))return C;if(o.includes(_.SHARE_TYPE_LINK)||o.includes(_.SHARE_TYPE_EMAIL))return I;if(o.includes(_.SHARE_TYPE_GROUP)||o.includes(_.SHARE_TYPE_REMOTE_GROUP))return N;if(o.includes(_.SHARE_TYPE_CIRCLE))return ue;const l=(a=r==null?void 0:r.attributes)==null?void 0:a["owner-id"];return l&&l!==((n=m())==null?void 0:n.uid)?pe(l):C},enabled(e){var s,i,a;if(e.length!==1)return!1;const n=e[0],r=(s=n==null?void 0:n.attributes)==null?void 0:s["owner-id"];return Array.isArray((i=n.attributes)==null?void 0:i["share-types"])||r&&r!==((a=m())==null?void 0:a.uid)?!0:(n.permissions&T.SHARE)!==0},async exec(e,s,i){var a,n,r,o;return e.permissions&T.READ?((o=(r=(n=(a=window.OCA)==null?void 0:a.Files)==null?void 0:n.Sidebar)==null?void 0:r.setActiveTab)==null||o.call(r,"sharing"),J.exec(e,s,i)):null},inline:()=>!0});v(ce);ne(),b("nc:share-attributes",{nc:"http://nextcloud.org/ns"}),b("oc:share-types",{oc:"http://owncloud.org/ns"}),b("ocs:share-permissions",{ocs:"http://open-collaboration-services.org/ns"});
