const __vite__fileDeps=["./chunks/TemplatePicker-C10FHdUP.mjs","./core-common.mjs","./chunks/index-7XKGWWeV.mjs","./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs","./chunks/index-CPCGRGcp.mjs","./chunks/index-CFlSzEWv.mjs","./chunks/index-BxKJ4nfQ.mjs","./chunks/icons-DENytzON.mjs","./chunks/logger-abzvQ-j7.mjs"],__vite__mapDeps=i=>i.map(i=>__vite__fileDeps[i]);
/*! third party licenses: dist/vendor.LICENSE.txt */
import{F as h,P as c,e as u,D as V,l as H,u as te,v as S,c as ne,w as ie,p as C,V as g,b as oe,h as re,a as se,d as k,f as ae,r as p,m as A}from"./chunks/index-CPCGRGcp.mjs";import{bS as b,bR as w,bT as i,b_ as R,b$ as Y,bY as y,aW as G,a$ as le,F as de,T as ce,al as fe,c0 as T,a_ as ue,c1 as L,ck as pe}from"./core-common.mjs";import{p as I}from"./chunks/index-7XKGWWeV.mjs";import{j as me,z as J,B as he}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import{av as we,b7 as ye,b8 as ve,b9 as ge,ba as be,bb as Ne,bc as K,bd as P,b6 as Ce,aO as De,n as Fe,be as Se,bf as Ee,aa as xe,aq as Re}from"./chunks/icons-DENytzON.mjs";import{l as d}from"./chunks/logger-abzvQ-j7.mjs";import{P as Te}from"./chunks/index-BxD44Goc.mjs";import{e as Q}from"./chunks/index-CFlSzEWv.mjs";import{a as Ie,b as Pe,p as Oe,i as _e,c as ke}from"./chunks/LivePhotos-XU79RBPy.mjs";import{a as Ae}from"./chunks/sidebarAction-CLvoFgmx.mjs";import{u as Le}from"./chunks/index-Dr6Qtwvk.mjs";import{_ as We}from"./chunks/preload-helper-BG02UnR2.mjs";import{g as Ue,r as W,h as $e,a as X}from"./chunks/Files-CdZLDCuJ.mjs";import"./chunks/index-BxKJ4nfQ.mjs";import"./chunks/pinia-DMoXqkoa.mjs";const v=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="shared"),E=e=>e.every(t=>t.attributes["is-mount-root"]===!0&&t.attributes["mount-type"]==="external"),qe=e=>{if(e.length===1)return!1;const t=e.some(o=>v([o])),n=e.some(o=>!v([o]));return t&&n},Be=e=>!e.some(t=>t.type!==u.File),je=e=>!e.some(t=>t.type!==u.Folder),U=(e,t)=>t.id==="trashbin"?i("files","Delete permanently"):qe(e)?i("files","Delete and unshare"):v(e)?e.length===1?i("files","Leave this share"):i("files","Leave these shares"):E(e)?e.length===1?i("files","Disconnect storage"):i("files","Disconnect storages"):Be(e)?e.length===1?i("files","Delete file"):i("files","Delete files"):je(e)?e.length===1?i("files","Delete folder"):i("files","Delete folders"):i("files","Delete"),Me=new Te({concurrency:1}),ze=new h({id:"delete",displayName:U,iconSvgInline:e=>v(e)?we:E(e)?ye:ve,enabled(e){return e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.DELETE)!==0)},async exec(e){try{return await b.delete(e.encodedSource),w("files:node:deleted",e),!0}catch(t){return d.error("Error while deleting a file",{error:t,source:e.source,node:e}),!1}},async execBatch(e,t,n){if(await new Promise(s=>{if(e.length>=5&&!v(e)&&!E(e)){window.OC.dialogs.confirmDestructive(i("files","You are about to delete {count} items.",{count:e.length}),i("files","Confirm deletion"),{type:window.OC.dialogs.YES_NO_BUTTONS,confirm:U(e,t),confirmClasses:"error",cancel:i("files","Cancel")},a=>{s(a)});return}s(!0)})===!1)return me(i("files","Deletion cancelled")),Promise.all(e.map(()=>!1));const o=e.map(s=>new Promise(a=>{Me.add(async()=>{const r=await this.exec(s,t,n);a(r!==null?r:!1)})}));return Promise.all(o)},order:100}),Z=function(e){const t=document.createElement("a");t.download="",t.href=e,t.click()},$=function(e,t){const n=Math.random().toString(36).substring(2),o=R("/apps/files/ajax/download.php?dir={dir}&files={files}&downloadStartSecret={secret}",{dir:e,secret:n,files:JSON.stringify(t.map(s=>s.basename))});Z(o)},Ve=function(e){var t,n;if(!(e.permissions&c.READ))return!1;if(e.attributes["mount-type"]==="shared"){const o=JSON.parse((t=e.attributes["share-attributes"])!=null?t:"null"),s=(n=o==null?void 0:o.find)==null?void 0:n.call(o,a=>a.scope==="permissions"&&a.key==="download");if(s!==void 0&&s.enabled===!1)return!1}return!0},He=new h({id:"download",displayName:()=>i("files","Download"),iconSvgInline:()=>ge,enabled(e){return e.length===0||e.some(t=>t.type===u.Folder)&&e.some(t=>{var n;return!((n=t.root)!=null&&n.startsWith("/files"))})?!1:e.every(Ve)},async exec(e,t,n){return e.type===u.Folder?($(n,[e]),null):(Z(e.encodedSource),null)},async execBatch(e,t,n){return e.length===1?(this.exec(e[0],t,n),[null]):($(n,e),new Array(e.length).fill(null))},order:30}),Ye=async function(e){var t;const n=Y("apps/files/api/v1")+"/openlocaleditor?format=json";try{const o=await b.post(n,{path:e}),s=(t=y())==null?void 0:t.uid;let a="nc://open/".concat(s,"@")+window.location.host+Q(e);a+="?token="+o.data.ocs.data.token,window.location.href=a}catch{J(i("files","Failed to redirect to client"))}},Ge=new h({id:"edit-locally",displayName:()=>i("files","Edit locally"),iconSvgInline:()=>be,enabled(e){return e.length!==1?!1:(e[0].permissions&c.UPDATE)!==0},async exec(e){return Ye(e.path),null},order:25}),N=e=>e.some(t=>t.attributes.favorite!==1),q=async(e,t,n)=>{try{const o=R("/apps/files/api/v1/files")+Q(e.path);return await b.post(o,{tags:n?[window.OC.TAG_FAVORITE]:[]}),t.id==="favorites"&&!n&&e.dirname==="/"&&w("files:node:deleted",e),G.set(e.attributes,"favorite",n?1:0),n?w("files:favorites:added",e):w("files:favorites:removed",e),!0}catch(o){const s=n?"adding a file to favourites":"removing a file from favourites";return d.error("Error while "+s,{error:o,source:e.source,node:e}),!1}},Je=new h({id:"favorite",displayName(e){return N(e)?i("files","Add to favorites"):i("files","Remove from favorites")},iconSvgInline:e=>N(e)?Ne:K,enabled(e){return!e.some(t=>{var n,o;return!((o=(n=t.root)==null?void 0:n.startsWith)!=null&&o.call(n,"/files"))})&&e.every(t=>t.permissions!==c.NONE)},async exec(e,t){const n=N([e]);return await q(e,t,n)},async execBatch(e,t){const n=N(e);return Promise.all(e.map(async o=>await q(o,t,n)))},order:-50}),Ke=new h({id:"open-folder",displayName(e){const t=e[0].attributes.displayName||e[0].basename;return i("files","Open folder {displayName}",{displayName:t})},iconSvgInline:()=>P,enabled(e){if(e.length!==1)return!1;const t=e[0];return t.isDavRessource?t.type===u.Folder&&(t.permissions&c.READ)!==0:!1},async exec(e,t){return!e||e.type!==u.Folder?!1:(window.OCP.Files.Router.goToRoute(null,{view:t.id,fileid:e.fileid},{dir:e.path}),null)},default:V.HIDDEN,order:-100}),Qe=new h({id:"open-in-files-recent",displayName:()=>i("files","Open in Files"),iconSvgInline:()=>"",enabled:(e,t)=>t.id==="recent",async exec(e){let t=e.dirname;return e.type===u.Folder&&(t=t+"/"+e.basename),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:t}),null},order:-1e3,default:V.HIDDEN}),Xe=new h({id:"rename",displayName:()=>i("files","Rename"),iconSvgInline:()=>Ce,enabled:e=>e.length>0&&e.map(t=>t.permissions).every(t=>(t&c.UPDATE)!==0),async exec(e){return w("files:node:rename",e),null},order:10}),Ze=new h({id:"view-in-folder",displayName(){return i("files","View in folder")},iconSvgInline:()=>De,enabled(e,t){if(t.id==="files"||e.length!==1)return!1;const n=e[0];return!n.isDavRessource||n.permissions===c.NONE?!1:n.type===u.File},async exec(e){return!e||e.type!==u.File?!1:(window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:e.fileid},{dir:e.dirname}),null)},order:80}),et=le({name:"NewNodeDialog",components:{NcButton:de,NcDialog:ce,NcTextField:fe},props:{defaultName:{type:String,default:i("files","New folder")},otherNames:{type:Array,default:()=>[]},open:{type:Boolean,default:!0},name:{type:String,default:i("files","Create new folder")},label:{type:String,default:i("files","Folder name")}},emits:{close:e=>e===null||e},data(){return{localDefaultName:this.defaultName||i("files","New folder")}},computed:{errorMessage(){return this.isUniqueName?"":i("files","A file or folder with that name already exists.")},uniqueName(){return Ie(this.localDefaultName,this.otherNames)},isUniqueName(){return this.localDefaultName===this.uniqueName}},watch:{defaultName(){this.localDefaultName=this.defaultName||i("files","New folder")},open(){this.$nextTick(()=>this.focusInput())}},mounted(){this.localDefaultName=this.uniqueName,this.$nextTick(()=>this.focusInput())},methods:{t:i,focusInput(){this.open&&this.$nextTick(()=>{var e,t;return(t=(e=this.$refs.input)==null?void 0:e.focus)==null?void 0:t.call(e)})},onCreate(){this.$emit("close",this.localDefaultName)},onClose(e){e||this.$emit("close",null)}}});var tt=function(){var e=this,t=e._self._c;return e._self._setupProxy,t("NcDialog",{attrs:{name:e.name,open:e.open,"close-on-click-outside":"","out-transition":""},on:{"update:open":e.onClose},scopedSlots:e._u([{key:"actions",fn:function(){return[t("NcButton",{attrs:{type:"primary",disabled:!e.isUniqueName},on:{click:e.onCreate}},[e._v(" "+e._s(e.t("files","Create"))+" ")])]},proxy:!0}])},[t("form",{on:{submit:function(n){return n.preventDefault(),e.onCreate.apply(null,arguments)}}},[t("NcTextField",{ref:"input",attrs:{error:!e.isUniqueName,"helper-text":e.errorMessage,label:e.label,value:e.localDefaultName},on:{"update:value":function(n){e.localDefaultName=n}}})],1)])},nt=[],it=Fe(et,tt,nt,!1,null,null);const ot=it.exports;function O(e,t,n={}){const o=t.map(s=>s.basename);return new Promise(s=>{Le(ot,{...n,defaultName:e,otherNames:o},a=>{s(a)})})}const rt=async(e,t)=>{const n=e.source+"/"+t,o=e.encodedSource+"/"+encodeURIComponent(t),s=await b({method:"MKCOL",url:o,headers:{Overwrite:"F"}});return{fileid:parseInt(s.headers["oc-fileid"]),source:n}},st={id:"newFolder",displayName:i("files","New folder"),enabled:e=>(e.permissions&c.CREATE)!==0,iconSvgInline:Se,order:0,async handler(e,t){var n,o,s,a,r;const l=await O(i("files","New folder"),t);if(l!==null){const{fileid:f,source:m}=await rt(e,l),D=new H({source:m,id:f,mtime:new Date,owner:((n=y())==null?void 0:n.uid)||null,permissions:c.ALL,root:(e==null?void 0:e.root)||"/files/"+((o=y())==null?void 0:o.uid),attributes:{"mount-type":(s=e.attributes)==null?void 0:s["mount-type"],"owner-id":(a=e.attributes)==null?void 0:a["owner-id"],"owner-display-name":(r=e.attributes)==null?void 0:r["owner-display-name"]}});he(i("files",'Created new folder "{name}"',{name:I.basename(m)})),d.debug("Created new folder",{folder:D,source:m}),w("files:node:created",D),window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:D.fileid},{dir:e.path})}}};let _=T("files","templates_path",!1);d.debug("Initial templates folder",{templatesPath:_});const at=async function(e,t){const n=I.join(e.path,t);try{d.debug("Initializing the templates directory",{templatePath:n});const{data:o}=await b.post(Y("apps/files/api/v1/templates/path"),{templatePath:n,copySystemTemplates:!0});window.OCP.Files.Router.goToRoute(null,{view:"files",fileid:void 0},{dir:n}),d.info("Created new templates folder",{...o.ocs.data}),_=o.ocs.data.templates_path}catch{d.error("Unable to initialize the templates directory"),J(i("files","Unable to initialize the templates directory"))}},lt={id:"template-picker",displayName:i("files","Create new templates folder"),iconSvgInline:Ee,order:10,enabled(e){var t;return _||e.owner!==((t=y())==null?void 0:t.uid)?!1:(e.permissions&c.CREATE)!==0},async handler(e,t){const n=await O(i("files","Templates"),t,{name:i("files","New template folder")});n!==null&&(at(e,n),te("template-picker"))}},dt=ue(()=>We(()=>import("./chunks/TemplatePicker-C10FHdUP.mjs"),__vite__mapDeps([0,1,2,3,4,5,6,7,8]),import.meta.url));let F=null;const ct=async e=>{if(F===null){const t=document.createElement("div");t.id="template-picker",document.body.appendChild(t),F=new G({render:n=>n(dt,{ref:"picker",props:{parent:e}}),methods:{open(...n){this.$refs.picker.open(...n)}},el:t})}return F};function ft(){T("files","templates",[]).forEach((e,t)=>{S({id:"template-new-".concat(e.app,"-").concat(t),displayName:e.label,iconClass:e.iconClass||"icon-file",iconSvgInline:e.iconSvgInline,enabled(n){return(n.permissions&c.CREATE)!==0},order:11,async handler(n,o){const s=ct(n),a=await O("".concat(e.label).concat(e.extension),o,{label:i("files","Filename"),name:e.label});a!==null&&(await s).open(a,e)}})})}const B=Ue(),ee=async(e="/")=>{const t=ne(),n=ie();let o;e==="/"&&(o=await B.stat(e,{details:!0,data:t}));const s=await B.getDirectoryContents(e,{details:!0,data:e==="/"?n:t,headers:{method:e==="/"?"REPORT":"PROPFIND"},includeSelf:!0}),a=(o==null?void 0:o.data)||s.data[0],r=s.data.filter(l=>l.filename!==e);return{folder:W(a),contents:r.map(W)}},j=function(e,t=0){return new g({id:x(e.path),name:I.basename(e.path),icon:P,order:t,params:{dir:e.path,fileid:e.fileid.toString(),view:"favorites"},parent:"favorites",columns:[],getContents:ee})},x=function(e){return"favorite-".concat($e(e))},ut=()=>{const e=T("files","favoriteFolders",[]),t=e.map((r,l)=>j(r,l));d.debug("Generating favorites view",{favoriteFolders:e});const n=C();n.register(new g({id:"favorites",name:i("files","Favorites"),caption:i("files","List of favorites files and folders."),emptyTitle:i("files","No favorites yet"),emptyCaption:i("files","Files and folders you mark as favorite will show up here"),icon:K,order:15,columns:[],getContents:ee})),t.forEach(r=>n.register(r)),L("files:favorites:added",r=>{var l;if(r.type===u.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}s(r)}}),L("files:favorites:removed",r=>{var l;if(r.type===u.Folder){if(r.path===null||!((l=r.root)!=null&&l.startsWith("/files"))){d.error("Favorite folder is not within user files root",{node:r});return}a(r.path)}});const o=function(){e.sort((r,l)=>r.path.localeCompare(l.path,pe(),{ignorePunctuation:!0})),e.forEach((r,l)=>{const f=t.find(m=>m.id===x(r.path));f&&(f.order=l)})},s=function(r){const l={path:r.path,fileid:r.fileid},f=j(l);e.find(m=>m.path===r.path)||(e.push(l),t.push(f),o(),n.register(f))},a=function(r){const l=x(r),f=e.findIndex(m=>m.path===r);f!==-1&&(e.splice(f,1),t.splice(f,1),n.remove(l),o())}},pt=oe(),mt=Math.round(Date.now()/1e3-60*60*24*14),ht=async(e="/")=>{var t;const n=Pe(Oe),o=a=>e!=="/"||n.userConfig.show_hidden||!a.dirname.split("/").some(r=>r.startsWith(".")),s=(await pt.getDirectoryContents(e,{details:!0,data:re(mt),headers:{method:"SEARCH","Content-Type":"application/xml; charset=utf-8"},deep:!0})).data;return{folder:new H({id:0,source:"".concat(se).concat(k),root:k,owner:((t=y())==null?void 0:t.uid)||null,permissions:c.READ}),contents:s.map(a=>ae(a)).filter(o)}},wt=()=>{C().register(new g({id:"recent",name:i("files","Recent"),caption:i("files","List of recently modified files and folders."),emptyTitle:i("files","No recently modified files"),emptyCaption:i("files","Files and folders you recently modified will show up here."),icon:xe,order:10,defaultSortKey:"mtime",getContents:ht}))};var M;const z=(M=y())==null?void 0:M.uid,yt=function(e){const t=["group","shared"],n=e.attributes["mount-type"];return(z?e.owner===z:!0)&&!t.includes(n)},vt=(e="/")=>X(e).then(t=>(t.contents=t.contents.filter(yt),t)),gt=()=>{C().register(new g({id:"personal",name:i("files","Personal Files"),caption:i("files","List of your files and folders that are not shared."),emptyTitle:i("files","No personal files found"),emptyCaption:i("files","Files that are not shared will show up here."),icon:Re,order:5,getContents:vt}))},bt=()=>{C().register(new g({id:"files",name:i("files","All files"),caption:i("files","List of your files and folders."),icon:P,order:0,getContents:X}))},Nt=()=>{"serviceWorker"in navigator?window.addEventListener("load",async()=>{try{const e=R("/apps/files/preview-service-worker.js",{},{noRewrite:!0}),t=await navigator.serviceWorker.register(e,{scope:"/"});d.debug("SW registered: ",{registration:t})}catch(e){d.error("SW registration failed: ",{error:e})}}):d.debug("Service Worker is not enabled on this browser.")};p(ze),p(He),p(Ge),p(Je),p(ke),p(Ke),p(Qe),p(Xe),p(Ae),p(Ze),S(st),S(lt),ft(),ut(),bt(),wt(),gt(),Nt(),A("nc:hidden",{nc:"http://nextcloud.org/ns"}),A("nc:is-mount-root",{nc:"http://nextcloud.org/ns"}),_e();
