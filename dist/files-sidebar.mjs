/*! third party licenses: dist/vendor.LICENSE.txt */
var V=Object.defineProperty;var z=(e,i,n)=>i in e?V(e,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[i]=n;var u=(e,i,n)=>(z(e,typeof i!="symbol"?i+"":i,n),n);import{bS as $,C as j,X as M,aW as S,a4 as W,ag as H,bT as g,b as X,B as Y,P as G,a1 as K,bY as C,c2 as J,cd as Q,b_ as Z,bR as b,bW as tt,cy as et}from"./core-common.mjs";import"./chunks/index-7XKGWWeV.mjs";import{z as y}from"./chunks/_plugin-vue2_normalizer-VrK6B12S-B9aYHv6f.mjs";import{c as it,i as nt,l as st,k as ot}from"./chunks/index-CPCGRGcp.mjs";import{e as at}from"./chunks/index-CFlSzEWv.mjs";import{T as F}from"./chunks/index-YIotKjSS.mjs";import{n as w,b as rt,ae as lt}from"./chunks/icons-DENytzON.mjs";import{$ as dt}from"./chunks/jquery-D5ATjA6D.mjs";import{b as A,e as ct,p as ht,l as N,g as k,c as ft,f as ut,h as pt,d as P}from"./chunks/api-B_uVXhYX.mjs";import{l as D}from"./chunks/logger-abzvQ-j7.mjs";import{u as R,s as gt,O as mt,n as yt,v as B,j as bt}from"./chunks/json2xml-BD0x8Z3S.mjs";import"./chunks/index-BxKJ4nfQ.mjs";class vt{constructor(i){this.tagname=i,this.child=[],this[":@"]={}}add(i,n){i==="__proto__"&&(i="#__proto__"),this.child.push({[i]:n})}addChild(i){i.tagname==="__proto__"&&(i.tagname="#__proto__"),i[":@"]&&Object.keys(i[":@"]).length>0?this.child.push({[i.tagname]:i.child,":@":i[":@"]}):this.child.push({[i.tagname]:i.child})}}var wt=vt;const Tt=R;function xt(e,i){const n={};if(e[i+3]==="O"&&e[i+4]==="C"&&e[i+5]==="T"&&e[i+6]==="Y"&&e[i+7]==="P"&&e[i+8]==="E"){i=i+9;let o=1,s=!1,a=!1,r="";for(;i<e.length;i++)if(e[i]==="<"&&!a){if(s&&It(e,i))i+=7,[entityName,val,i]=St(e,i+1),val.indexOf("&")===-1&&(n[Ot(entityName)]={regx:RegExp("&".concat(entityName,";"),"g"),val});else if(s&&Et(e,i))i+=8;else if(s&&At(e,i))i+=8;else if(s&&Nt(e,i))i+=9;else if(_t)a=!0;else throw new Error("Invalid DOCTYPE");o++,r=""}else if(e[i]===">"){if(a?e[i-1]==="-"&&e[i-2]==="-"&&(a=!1,o--):o--,o===0)break}else e[i]==="["?s=!0:r+=e[i];if(o!==0)throw new Error("Unclosed DOCTYPE")}else throw new Error("Invalid Tag instead of DOCTYPE");return{entities:n,i}}function St(e,i){let n="";for(;i<e.length&&e[i]!=="'"&&e[i]!=='"';i++)n+=e[i];if(n=n.trim(),n.indexOf(" ")!==-1)throw new Error("External entites are not supported");const o=e[i++];let s="";for(;i<e.length&&e[i]!==o;i++)s+=e[i];return[n,s,i]}function _t(e,i){return e[i+1]==="!"&&e[i+2]==="-"&&e[i+3]==="-"}function It(e,i){return e[i+1]==="!"&&e[i+2]==="E"&&e[i+3]==="N"&&e[i+4]==="T"&&e[i+5]==="I"&&e[i+6]==="T"&&e[i+7]==="Y"}function Et(e,i){return e[i+1]==="!"&&e[i+2]==="E"&&e[i+3]==="L"&&e[i+4]==="E"&&e[i+5]==="M"&&e[i+6]==="E"&&e[i+7]==="N"&&e[i+8]==="T"}function At(e,i){return e[i+1]==="!"&&e[i+2]==="A"&&e[i+3]==="T"&&e[i+4]==="T"&&e[i+5]==="L"&&e[i+6]==="I"&&e[i+7]==="S"&&e[i+8]==="T"}function Nt(e,i){return e[i+1]==="!"&&e[i+2]==="N"&&e[i+3]==="O"&&e[i+4]==="T"&&e[i+5]==="A"&&e[i+6]==="T"&&e[i+7]==="I"&&e[i+8]==="O"&&e[i+9]==="N"}function Ot(e){if(Tt.isName(e))return e;throw new Error("Invalid entity name ".concat(e))}var Ct=xt;const q=R,v=wt,Ft=Ct,Pt=gt;let Dt=class{constructor(e){this.options=e,this.currentNode=null,this.tagsNodeStack=[],this.docTypeEntities={},this.lastEntities={apos:{regex:/&(apos|#39|#x27);/g,val:"'"},gt:{regex:/&(gt|#62|#x3E);/g,val:">"},lt:{regex:/&(lt|#60|#x3C);/g,val:"<"},quot:{regex:/&(quot|#34|#x22);/g,val:'"'}},this.ampEntity={regex:/&(amp|#38|#x26);/g,val:"&"},this.htmlEntities={space:{regex:/&(nbsp|#160);/g,val:" "},cent:{regex:/&(cent|#162);/g,val:"¢"},pound:{regex:/&(pound|#163);/g,val:"£"},yen:{regex:/&(yen|#165);/g,val:"¥"},euro:{regex:/&(euro|#8364);/g,val:"€"},copyright:{regex:/&(copy|#169);/g,val:"©"},reg:{regex:/&(reg|#174);/g,val:"®"},inr:{regex:/&(inr|#8377);/g,val:"₹"}},this.addExternalEntities=Lt,this.parseXml=Bt,this.parseTextData=$t,this.resolveNameSpace=Mt,this.buildAttributesMap=Rt,this.isItStopNode=zt,this.replaceEntitiesValue=Ut,this.readStopNodeData=Wt,this.saveTextToParentTag=Vt,this.addChild=qt}};function Lt(e){const i=Object.keys(e);for(let n=0;n<i.length;n++){const o=i[n];this.lastEntities[o]={regex:new RegExp("&"+o+";","g"),val:e[o]}}}function $t(e,i,n,o,s,a,r){if(e!==void 0&&(this.options.trimValues&&!o&&(e=e.trim()),e.length>0)){r||(e=this.replaceEntitiesValue(e));const l=this.options.tagValueProcessor(i,e,n,s,a);return l==null?e:typeof l!=typeof e||l!==e?l:this.options.trimValues?I(e,this.options.parseTagValue,this.options.numberParseOptions):e.trim()===e?I(e,this.options.parseTagValue,this.options.numberParseOptions):e}}function Mt(e){if(this.options.removeNSPrefix){const i=e.split(":"),n=e.charAt(0)==="/"?"/":"";if(i[0]==="xmlns")return"";i.length===2&&(e=n+i[1])}return e}const kt=new RegExp("([^\\s=]+)\\s*(=\\s*(['\"])([\\s\\S]*?)\\3)?","gm");function Rt(e,i,n){if(!this.options.ignoreAttributes&&typeof e=="string"){const o=q.getAllMatches(e,kt),s=o.length,a={};for(let r=0;r<s;r++){const l=this.resolveNameSpace(o[r][1]);let c=o[r][4],d=this.options.attributeNamePrefix+l;if(l.length)if(this.options.transformAttributeName&&(d=this.options.transformAttributeName(d)),d==="__proto__"&&(d="#__proto__"),c!==void 0){this.options.trimValues&&(c=c.trim()),c=this.replaceEntitiesValue(c);const h=this.options.attributeValueProcessor(l,c,i);h==null?a[d]=c:typeof h!=typeof c||h!==c?a[d]=h:a[d]=I(c,this.options.parseAttributeValue,this.options.numberParseOptions)}else this.options.allowBooleanAttributes&&(a[d]=!0)}if(!Object.keys(a).length)return;if(this.options.attributesGroupName){const r={};return r[this.options.attributesGroupName]=a,r}return a}}const Bt=function(e){e=e.replace(/\r\n?/g,"\n");const i=new v("!xml");let n=i,o="",s="";for(let a=0;a<e.length;a++)if(e[a]==="<")if(e[a+1]==="/"){const r=m(e,">",a,"Closing Tag is not closed.");let l=e.substring(a+2,r).trim();if(this.options.removeNSPrefix){const h=l.indexOf(":");h!==-1&&(l=l.substr(h+1))}this.options.transformTagName&&(l=this.options.transformTagName(l)),n&&(o=this.saveTextToParentTag(o,n,s));const c=s.substring(s.lastIndexOf(".")+1);if(l&&this.options.unpairedTags.indexOf(l)!==-1)throw new Error("Unpaired tag can not be used as closing tag: </".concat(l,">"));let d=0;c&&this.options.unpairedTags.indexOf(c)!==-1?(d=s.lastIndexOf(".",s.lastIndexOf(".")-1),this.tagsNodeStack.pop()):d=s.lastIndexOf("."),s=s.substring(0,d),n=this.tagsNodeStack.pop(),o="",a=r}else if(e[a+1]==="?"){let r=_(e,a,!1,"?>");if(!r)throw new Error("Pi Tag is not closed.");if(o=this.saveTextToParentTag(o,n,s),!(this.options.ignoreDeclaration&&r.tagName==="?xml"||this.options.ignorePiTags)){const l=new v(r.tagName);l.add(this.options.textNodeName,""),r.tagName!==r.tagExp&&r.attrExpPresent&&(l[":@"]=this.buildAttributesMap(r.tagExp,s,r.tagName)),this.addChild(n,l,s)}a=r.closeIndex+1}else if(e.substr(a+1,3)==="!--"){const r=m(e,"-->",a+4,"Comment is not closed.");if(this.options.commentPropName){const l=e.substring(a+4,r-2);o=this.saveTextToParentTag(o,n,s),n.add(this.options.commentPropName,[{[this.options.textNodeName]:l}])}a=r}else if(e.substr(a+1,2)==="!D"){const r=Ft(e,a);this.docTypeEntities=r.entities,a=r.i}else if(e.substr(a+1,2)==="!["){const r=m(e,"]]>",a,"CDATA is not closed.")-2,l=e.substring(a+9,r);o=this.saveTextToParentTag(o,n,s);let c=this.parseTextData(l,n.tagname,s,!0,!1,!0,!0);c==null&&(c=""),this.options.cdataPropName?n.add(this.options.cdataPropName,[{[this.options.textNodeName]:l}]):n.add(this.options.textNodeName,c),a=r+2}else{let r=_(e,a,this.options.removeNSPrefix),l=r.tagName;const c=r.rawTagName;let d=r.tagExp,h=r.attrExpPresent,p=r.closeIndex;this.options.transformTagName&&(l=this.options.transformTagName(l)),n&&o&&n.tagname!=="!xml"&&(o=this.saveTextToParentTag(o,n,s,!1));const O=n;if(O&&this.options.unpairedTags.indexOf(O.tagname)!==-1&&(n=this.tagsNodeStack.pop(),s=s.substring(0,s.lastIndexOf("."))),l!==i.tagname&&(s+=s?"."+l:l),this.isItStopNode(this.options.stopNodes,s,l)){let f="";if(d.length>0&&d.lastIndexOf("/")===d.length-1)a=r.closeIndex;else if(this.options.unpairedTags.indexOf(l)!==-1)a=r.closeIndex;else{const x=this.readStopNodeData(e,c,p+1);if(!x)throw new Error("Unexpected end of ".concat(c));a=x.i,f=x.tagContent}const T=new v(l);l!==d&&h&&(T[":@"]=this.buildAttributesMap(d,s,l)),f&&(f=this.parseTextData(f,l,s,!0,h,!0,!0)),s=s.substr(0,s.lastIndexOf(".")),T.add(this.options.textNodeName,f),this.addChild(n,T,s)}else{if(d.length>0&&d.lastIndexOf("/")===d.length-1){l[l.length-1]==="/"?(l=l.substr(0,l.length-1),s=s.substr(0,s.length-1),d=l):d=d.substr(0,d.length-1),this.options.transformTagName&&(l=this.options.transformTagName(l));const f=new v(l);l!==d&&h&&(f[":@"]=this.buildAttributesMap(d,s,l)),this.addChild(n,f,s),s=s.substr(0,s.lastIndexOf("."))}else{const f=new v(l);this.tagsNodeStack.push(n),l!==d&&h&&(f[":@"]=this.buildAttributesMap(d,s,l)),this.addChild(n,f,s),n=f}o="",a=p}}else o+=e[a];return i.child};function qt(e,i,n){const o=this.options.updateTag(i.tagname,n,i[":@"]);o===!1||(typeof o=="string"&&(i.tagname=o),e.addChild(i))}const Ut=function(e){if(this.options.processEntities){for(let i in this.docTypeEntities){const n=this.docTypeEntities[i];e=e.replace(n.regx,n.val)}for(let i in this.lastEntities){const n=this.lastEntities[i];e=e.replace(n.regex,n.val)}if(this.options.htmlEntities)for(let i in this.htmlEntities){const n=this.htmlEntities[i];e=e.replace(n.regex,n.val)}e=e.replace(this.ampEntity.regex,this.ampEntity.val)}return e};function Vt(e,i,n,o){return e&&(o===void 0&&(o=Object.keys(i.child).length===0),e=this.parseTextData(e,i.tagname,n,!1,i[":@"]?Object.keys(i[":@"]).length!==0:!1,o),e!==void 0&&e!==""&&i.add(this.options.textNodeName,e),e=""),e}function zt(e,i,n){const o="*."+n;for(const s in e){const a=e[s];if(o===a||i===a)return!0}return!1}function jt(e,i,n=">"){let o,s="";for(let a=i;a<e.length;a++){let r=e[a];if(o)r===o&&(o="");else if(r==='"'||r==="'")o=r;else if(r===n[0])if(n[1]){if(e[a+1]===n[1])return{data:s,index:a}}else return{data:s,index:a};else r==="	"&&(r=" ");s+=r}}function m(e,i,n,o){const s=e.indexOf(i,n);if(s===-1)throw new Error(o);return s+i.length-1}function _(e,i,n,o=">"){const s=jt(e,i+1,o);if(!s)return;let a=s.data;const r=s.index,l=a.search(/\s/);let c=a,d=!0;l!==-1&&(c=a.substring(0,l),a=a.substring(l+1).trimStart());const h=c;if(n){const p=c.indexOf(":");p!==-1&&(c=c.substr(p+1),d=c!==s.data.substr(p+1))}return{tagName:c,tagExp:a,closeIndex:r,attrExpPresent:d,rawTagName:h}}function Wt(e,i,n){const o=n;let s=1;for(;n<e.length;n++)if(e[n]==="<")if(e[n+1]==="/"){const a=m(e,">",n,"".concat(i," is not closed"));if(e.substring(n+2,a).trim()===i&&(s--,s===0))return{tagContent:e.substring(o,n),i:a};n=a}else if(e[n+1]==="?")n=m(e,"?>",n+1,"StopNode is not closed.");else if(e.substr(n+1,3)==="!--")n=m(e,"-->",n+3,"StopNode is not closed.");else if(e.substr(n+1,2)==="![")n=m(e,"]]>",n,"StopNode is not closed.")-2;else{const a=_(e,n,">");a&&((a&&a.tagName)===i&&a.tagExp[a.tagExp.length-1]!=="/"&&s++,n=a.closeIndex)}}function I(e,i,n){if(i&&typeof e=="string"){const o=e.trim();return o==="true"?!0:o==="false"?!1:Pt(e,n)}else return q.isExist(e)?e:""}var Ht=Dt;const{buildOptions:Xt}=mt,Yt=Ht,{prettify:Gt}=yt,Kt=B;let Jt=class{constructor(e){this.externalEntities={},this.options=Xt(e)}parse(e,i){if(typeof e!="string")if(e.toString)e=e.toString();else throw new Error("XML data is accepted in String or Bytes[] form.");if(i){i===!0&&(i={});const s=Kt.validate(e,i);if(s!==!0)throw Error("".concat(s.err.msg,":").concat(s.err.line,":").concat(s.err.col))}const n=new Yt(this.options);n.addExternalEntities(this.externalEntities);const o=n.parseXml(e);return this.options.preserveOrder||o===void 0?o:Gt(o,this.options)}addEntity(e,i){if(i.indexOf("&")!==-1)throw new Error("Entity value can't have '&'");if(e.indexOf("&")!==-1||e.indexOf(";")!==-1)throw new Error("An entity must be set without '&' and ';'. Eg. use '#xD' for '&#xD;'");if(i==="&")throw new Error("An entity with value '&' is not permitted");this.externalEntities[e]=i}};var Qt=Jt;const Zt=B,te=Qt,ee=bt;var ie={XMLParser:te,XMLValidator:Zt,XMLBuilder:ee};async function ne(e){const i=await $({method:"PROPFIND",url:e,data:it()}),n=OC.Files.getClient()._client.parseMultiStatus(i.data),o=OC.Files.getClient()._parseFileInfo(n[0]);return o.get=s=>o[s],o.isDirectory=()=>o.mimetype==="httpd/unix-directory",o}const se={name:"LegacyView",props:{component:{type:Object,required:!0},fileInfo:{type:Object,default:()=>{},required:!0}},watch:{fileInfo(e){this.setFileInfo(e)}},mounted(){this.component.$el.replaceAll(this.$el),this.setFileInfo(this.fileInfo)},methods:{setFileInfo(e){this.component.setFileInfo(new OCA.Files.FileInfoModel(e))}}};var oe=function(){var e=this,i=e._self._c;return i("div")},ae=[],re=w(se,oe,ae,!1,null,null);const le=re.exports,de={name:"SidebarTab",components:{NcAppSidebarTab:j,NcEmptyContent:M},props:{fileInfo:{type:Object,default:()=>{},required:!0},id:{type:String,required:!0},name:{type:String,required:!0},icon:{type:String,required:!1},onMount:{type:Function,required:!0},onUpdate:{type:Function,required:!0},onDestroy:{type:Function,required:!0},onScrollBottomReached:{type:Function,default:()=>{}}},data(){return{loading:!0}},computed:{activeTab(){return this.$parent.activeTab}},watch:{async fileInfo(e,i){e.id!==i.id&&(this.loading=!0,await this.onUpdate(this.fileInfo),this.loading=!1)}},async mounted(){this.loading=!0,await this.onMount(this.$refs.mount,this.fileInfo,this.$refs.tab),this.loading=!1},async beforeDestroy(){await this.onDestroy()}};var ce=function(){var e=this,i=e._self._c;return i("NcAppSidebarTab",{ref:"tab",attrs:{id:e.id,name:e.name,icon:e.icon},on:{bottomReached:e.onScrollBottomReached},scopedSlots:e._u([{key:"icon",fn:function(){return[e._t("icon")]},proxy:!0}],null,!0)},[e.loading?i("NcEmptyContent",{attrs:{icon:"icon-loading"}}):e._e(),i("div",{ref:"mount"})],1)},he=[],fe=w(de,ce,he,!1,null,null);const ue=fe.exports,pe=async e=>{const i="/systemtags-relations/files/"+e;try{const{data:n}=await A.getDirectoryContents(i,{data:ct,details:!0,glob:"/systemtags-relations/files/*/*"});return ht(n)}catch(n){throw N.error(t("systemtags","Failed to load tags for file"),{error:n}),new Error(t("systemtags","Failed to load tags for file"))}},ge=async(e,i)=>{const n=k(e),o=await ft(n),s={...n,id:o};return await U(s,i),s.id},U=async(e,i)=>{const n="/systemtags-relations/files/"+i+"/"+e.id,o=k(e);try{await A.customRequest(n,{method:"PUT",data:o})}catch(s){throw N.error(t("systemtags","Failed to set tag for file"),{error:s}),new Error(t("systemtags","Failed to set tag for file"))}},me=async(e,i)=>{const n="/systemtags-relations/files/"+i+"/"+e.id;try{await A.deleteFile(n)}catch(o){throw N.error(t("systemtags","Failed to delete tag for file"),{error:o}),new Error(t("systemtags","Failed to delete tag for file"))}},ye=S.extend({name:"SystemTags",components:{NcLoadingIcon:W,NcSelectTags:H},props:{fileId:{type:Number,required:!0}},data(){return{sortedTags:[],selectedTags:[],loadingTags:!1,loading:!1}},async created(){try{const e=await ut(),i=await pt(),n=[],o=[];for(const a of e){if(i.includes(a.id)){n.push(a);continue}o.push(a)}const s=(a,r)=>i.indexOf(a.id)-i.indexOf(r.id);n.sort(s),this.sortedTags=[...n,...o]}catch{y(g("systemtags","Failed to load tags"))}},watch:{fileId:{immediate:!0,async handler(){this.loadingTags=!0;try{this.selectedTags=await pe(this.fileId),this.$emit("has-tags",this.selectedTags.length>0)}catch{y(g("systemtags","Failed to load selected tags"))}this.loadingTags=!1}}},methods:{t:g,createOption(e){for(const i of this.sortedTags){const{id:n,displayName:o,...s}=i;if(o===e&&Object.entries(s).every(([a,r])=>P[a]===r))return i}return{...P,displayName:e}},handleInput(e){this.selectedTags=e.filter(i=>!!i.id)},async handleSelect(e){const i=e[e.length-1];if(!i.id)return;const n=i;this.loading=!0;try{await U(n,this.fileId);const o=(s,a)=>s.id===n.id?-1:a.id===n.id?1:0;this.sortedTags.sort(o)}catch{y(g("systemtags","Failed to select tag"))}this.loading=!1},async handleCreate(e){this.loading=!0;try{const i=await ge(e,this.fileId),n={...e,id:i};this.sortedTags.unshift(n),this.selectedTags.push(n)}catch{y(g("systemtags","Failed to create tag"))}this.loading=!1},async handleDeselect(e){this.loading=!0;try{await me(e,this.fileId)}catch{y(g("systemtags","Failed to delete tag"))}this.loading=!1}}});var be=function(){var e=this,i=e._self._c;return e._self._setupProxy,i("div",{staticClass:"system-tags"},[e.loadingTags?i("NcLoadingIcon",{attrs:{name:e.t("systemtags","Loading collaborative tags …"),size:32}}):[i("NcSelectTags",{staticClass:"system-tags__select",attrs:{"input-label":e.t("systemtags","Search or create collaborative tags"),placeholder:e.t("systemtags","Collaborative tags …"),options:e.sortedTags,value:e.selectedTags,"create-option":e.createOption,taggable:!0,passthru:!0,"fetch-tags":!1,loading:e.loading},on:{input:e.handleInput,"option:selected":e.handleSelect,"option:created":e.handleCreate,"option:deselected":e.handleDeselect},scopedSlots:e._u([{key:"no-options",fn:function(){return[e._v(" "+e._s(e.t("systemtags","No tags to select, type to create a new tag"))+" ")]},proxy:!0}])})]],2)},ve=[],we=w(ye,be,ve,!1,null,"802c099e");const Te=we.exports,xe={name:"Sidebar",components:{LegacyView:le,NcActionButton:X,NcAppSidebar:Y,NcDateTime:G,NcEmptyContent:M,NcIconSvgWrapper:K,SidebarTab:ue,SystemTags:Te},setup(){return{currentUser:C(),mdiStar:rt,mdiStarOutline:lt}},data(){return{Sidebar:OCA.Files.Sidebar.state,showTags:!1,showTagsDefault:!0,error:null,loading:!0,fileInfo:null,isFullScreen:!1,hasLowHeight:!1}},computed:{file(){return this.Sidebar.file},tabs(){return this.Sidebar.tabs},views(){return this.Sidebar.views},davPath(){const e=this.currentUser.uid;return J("dav/files/".concat(e).concat(at(this.file)))},activeTab(){return this.Sidebar.activeTab},size(){var e;return nt((e=this.fileInfo)==null?void 0:e.size)},background(){return this.getPreviewIfAny(this.fileInfo)},appSidebar(){return this.fileInfo?{"data-mimetype":this.fileInfo.mimetype,active:this.activeTab,background:this.background,class:{"app-sidebar--has-preview":this.fileInfo.hasPreview&&!this.isFullScreen,"app-sidebar--full":this.isFullScreen},compact:this.hasLowHeight||!this.fileInfo.hasPreview||this.isFullScreen,loading:this.loading,name:this.fileInfo.name,title:this.fileInfo.name}:this.error?{key:"error",subname:"",name:"",class:{"app-sidebar--full":this.isFullScreen}}:{loading:this.loading,subname:"",name:"",class:{"app-sidebar--full":this.isFullScreen}}},defaultAction(){return this.fileInfo&&OCA.Files&&OCA.Files.App&&OCA.Files.App.fileList&&OCA.Files.App.fileList.fileActions&&OCA.Files.App.fileList.fileActions.getDefaultFileAction&&OCA.Files.App.fileList.fileActions.getDefaultFileAction(this.fileInfo.mimetype,this.fileInfo.type,OC.PERMISSION_READ)},defaultActionListener(){return this.defaultAction?"figure-click":null},isSystemTagsEnabled(){var e,i;return((i=(e=Q())==null?void 0:e.systemtags)==null?void 0:i.enabled)===!0}},created(){window.addEventListener("resize",this.handleWindowResize),this.handleWindowResize()},beforeDestroy(){window.removeEventListener("resize",this.handleWindowResize)},methods:{canDisplay(e){return e.enabled(this.fileInfo)},resetData(){this.error=null,this.fileInfo=null,this.$nextTick(()=>{this.$refs.tabs&&this.$refs.tabs.updateTabs()})},getPreviewIfAny(e){if(e!=null&&e.hasPreview&&!this.isFullScreen){const i=(e==null?void 0:e.etag)||"";return Z("/core/preview?fileId=".concat(e.id,"&x=").concat(screen.width,"&y=").concat(screen.height,"&a=true&v=").concat(i.slice(0,6)))}return this.getIconUrl(e)},getIconUrl(e){const i=(e==null?void 0:e.mimetype)||"application/octet-stream";return i==="httpd/unix-directory"?e.mountType==="shared"||e.mountType==="shared-root"?OC.MimeType.getIconUrl("dir-shared"):e.mountType==="external-root"?OC.MimeType.getIconUrl("dir-external"):e.mountType!==void 0&&e.mountType!==""?OC.MimeType.getIconUrl("dir-"+e.mountType):e.shareTypes&&(e.shareTypes.indexOf(F.SHARE_TYPE_LINK)>-1||e.shareTypes.indexOf(F.SHARE_TYPE_EMAIL)>-1)?OC.MimeType.getIconUrl("dir-public"):e.shareTypes&&e.shareTypes.length>0?OC.MimeType.getIconUrl("dir-shared"):OC.MimeType.getIconUrl("dir"):OC.MimeType.getIconUrl(i)},setActiveTab(e){OCA.Files.Sidebar.setActiveTab(e),this.tabs.forEach(i=>{try{i.setIsActive(e===i.id)}catch(n){D.error("Error while setting tab active state",{error:n,id:i.id,tab:i})}})},async toggleStarred(e){try{await $({method:"PROPPATCH",url:this.davPath,data:'<?xml version="1.0"?>\n						<d:propertyupdate xmlns:d="DAV:" xmlns:oc="http://owncloud.org/ns">\n						'.concat(e?"<d:set>":"<d:remove>","\n							<d:prop>\n								<oc:favorite>1</oc:favorite>\n							</d:prop>\n						").concat(e?"</d:set>":"</d:remove>","\n						</d:propertyupdate>")});const i=this.fileInfo.type==="dir",n=i?st:ot;b(e?"files:favorites:added":"files:favorites:removed",new n({fileid:this.fileInfo.id,source:this.davPath,root:"/files/".concat(C().uid),mime:i?void 0:this.fileInfo.mimetype})),this.fileInfo.isFavourited=e}catch(i){y(t("files","Unable to change the favourite state of the file")),D.error("Unable to change favourite state",{error:i})}},onDefaultAction(){this.defaultAction&&this.defaultAction.action(this.fileInfo.name,{fileInfo:this.fileInfo,dir:this.fileInfo.dir,fileList:OCA.Files.App.fileList,$file:dt("body")})},toggleTags(){this.showTagsDefault=this.showTags=!this.showTags},async open(e){if(!e||e.trim()==="")throw new Error("Invalid path '".concat(e,"'"));const i=!!this.Sidebar.file;this.Sidebar.file=e,this.error=null,this.loading=!0;try{this.fileInfo=await ne(this.davPath),this.fileInfo.dir=this.file.split("/").slice(0,-1).join("/"),this.views.forEach(n=>{n.setFileInfo(this.fileInfo)}),await this.$nextTick(),this.setActiveTab(this.Sidebar.activeTab||this.tabs[0].id),this.loading=!1,await this.$nextTick(),i&&this.$refs.sidebar.focusActiveTabContent()}catch(n){throw this.loading=!1,this.error=t("files","Error while loading the file data"),console.error("Error while loading the file data",n),new Error(n)}},close(){this.Sidebar.file="",this.showTags=!1,this.resetData()},setFullScreenMode(e){var i,n,o,s;this.isFullScreen=e,e?(i=document.querySelector("#content"))!=null&&i.classList.add("with-sidebar--full")||((n=document.querySelector("#content-vue"))==null||n.classList.add("with-sidebar--full")):(o=document.querySelector("#content"))!=null&&o.classList.remove("with-sidebar--full")||((s=document.querySelector("#content-vue"))==null||s.classList.remove("with-sidebar--full"))},setShowTagsDefault(e){this.showTagsDefault=e},handleOpening(){b("files:sidebar:opening")},handleOpened(){b("files:sidebar:opened")},handleClosing(){b("files:sidebar:closing")},handleClosed(){b("files:sidebar:closed")},handleWindowResize(){this.hasLowHeight=document.documentElement.clientHeight<1024}}};var Se=function(){var e=this,i=e._self._c;return e.file?i("NcAppSidebar",e._b({ref:"sidebar",attrs:{"cy-data-sidebar":"","force-menu":!0},on:e._d({close:e.close,"update:active":e.setActiveTab,opening:e.handleOpening,opened:e.handleOpened,closing:e.handleClosing,closed:e.handleClosed},[e.defaultActionListener,function(n){return n.stopPropagation(),n.preventDefault(),e.onDefaultAction.apply(null,arguments)}]),scopedSlots:e._u([e.fileInfo?{key:"subname",fn:function(){return[e.fileInfo.isFavourited?i("NcIconSvgWrapper",{attrs:{path:e.mdiStar,name:e.t("files","Favorite"),inline:""}}):e._e(),e._v(" "+e._s(e.size)+" "),i("NcDateTime",{attrs:{timestamp:e.fileInfo.mtime}})]},proxy:!0}:null,e.fileInfo?{key:"description",fn:function(){return[i("div",{staticClass:"sidebar__description"},[e.isSystemTagsEnabled&&e.showTagsDefault?i("SystemTags",{directives:[{name:"show",rawName:"v-show",value:e.showTags,expression:"showTags"}],attrs:{"file-id":e.fileInfo.id},on:{"has-tags":n=>e.showTags=n}}):e._e(),e._l(e.views,function(n){return i("LegacyView",{key:n.cid,attrs:{component:n,"file-info":e.fileInfo}})})],2)]},proxy:!0}:null,e.fileInfo?{key:"secondary-actions",fn:function(){return[i("NcActionButton",{attrs:{"close-after-click":!0},on:{click:function(n){return e.toggleStarred(!e.fileInfo.isFavourited)}},scopedSlots:e._u([{key:"icon",fn:function(){return[i("NcIconSvgWrapper",{attrs:{path:e.fileInfo.isFavourited?e.mdiStarOutline:e.mdiStar}})]},proxy:!0}],null,!1,3772937801)},[e._v(" "+e._s(e.fileInfo.isFavourited?e.t("files","Remove from favorites"):e.t("files","Add to favorites"))+" ")]),e.isSystemTagsEnabled?i("NcActionButton",{attrs:{"close-after-click":!0,icon:"icon-tag"},on:{click:e.toggleTags}},[e._v(" "+e._s(e.t("files","Tags"))+" ")]):e._e()]},proxy:!0}:null],null,!0)},"NcAppSidebar",e.appSidebar,!1),[e.error?i("NcEmptyContent",{attrs:{icon:"icon-error"}},[e._v(" "+e._s(e.error)+" ")]):e.fileInfo?e._l(e.tabs,function(n){return[n.enabled(e.fileInfo)?i("SidebarTab",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],key:n.id,attrs:{id:n.id,name:n.name,icon:n.icon,"on-mount":n.mount,"on-update":n.update,"on-destroy":n.destroy,"on-scroll-bottom-reached":n.scrollBottomReached,"file-info":e.fileInfo},scopedSlots:e._u([n.iconSvg!==void 0?{key:"icon",fn:function(){return[i("span",{staticClass:"svg-icon",domProps:{innerHTML:e._s(n.iconSvg)}})]},proxy:!0}:null],null,!0)}):e._e()]}):e._e()],2):e._e()},_e=[],Ie=w(xe,Se,_e,!1,null,"691ccc5c");const Ee=Ie.exports;class Ae{constructor(){u(this,"_state");this._state={},this._state.tabs=[],this._state.views=[],this._state.file="",this._state.activeTab="",console.debug("OCA.Files.Sidebar initialized")}get state(){return this._state}registerTab(i){return this._state.tabs.findIndex(n=>n.id===i.id)>-1?(console.error("An tab with the same id ".concat(i.id," already exists"),i),!1):(this._state.tabs.push(i),!0)}registerSecondaryView(i){return this._state.views.findIndex(n=>n.id===i.id)>-1?(console.error("A similar view already exists",i),!1):(this._state.views.push(i),!0)}get file(){return this._state.file}setActiveTab(i){this._state.activeTab=i}}var E={exports:{}};const{XMLParser:Ne,XMLValidator:Oe}=ie,L=e=>{if(e==null||(e=e.toString().trim(),e.length===0)||Oe.validate(e)!==!0)return!1;let i;const n=new Ne;try{i=n.parse(e)}catch{return!1}return!(!i||!("svg"in i))};E.exports=L,E.exports.default=L;var Ce=E.exports;const Fe=tt(Ce),Pe=e=>new Promise(i=>{if(!De(e))i(e.toString("utf-8"));else{const n=new FileReader;n.onload=()=>{i(n.result)},n.readAsText(e)}}),De=e=>e.size!==void 0,Le=async e=>{if(!e)throw new Error("Not an svg");let i="";if(et.isBuffer(e)||e instanceof File?i=await Pe(e):i=e,!Fe(i))throw new Error("Not an svg");const n=document.createElement("div");n.innerHTML=i;const o=n.firstElementChild,s=!!Array.from(o.attributes).map(({name:a})=>a).find(a=>a.startsWith("on"));return o.getElementsByTagName("script").length===0&&!s?e:null};class $e{constructor({id:i,name:n,icon:o,iconSvg:s,mount:a,setIsActive:r,update:l,destroy:c,enabled:d,scrollBottomReached:h}={}){u(this,"_id");u(this,"_name");u(this,"_icon");u(this,"_iconSvgSanitized");u(this,"_mount");u(this,"_setIsActive");u(this,"_update");u(this,"_destroy");u(this,"_enabled");u(this,"_scrollBottomReached");if(d===void 0&&(d=()=>!0),h===void 0&&(h=()=>{}),typeof i!="string"||i.trim()==="")throw new Error("The id argument is not a valid string");if(typeof n!="string"||n.trim()==="")throw new Error("The name argument is not a valid string");if((typeof o!="string"||o.trim()==="")&&typeof s!="string")throw new Error("Missing valid string for icon or iconSvg argument");if(typeof a!="function")throw new Error("The mount argument should be a function");if(r!==void 0&&typeof r!="function")throw new Error("The setIsActive argument should be a function");if(typeof l!="function")throw new Error("The update argument should be a function");if(typeof c!="function")throw new Error("The destroy argument should be a function");if(typeof d!="function")throw new Error("The enabled argument should be a function");if(typeof h!="function")throw new Error("The scrollBottomReached argument should be a function");this._id=i,this._name=n,this._icon=o,this._mount=a,this._setIsActive=r,this._update=l,this._destroy=c,this._enabled=d,this._scrollBottomReached=h,typeof s=="string"&&Le(s).then(p=>{this._iconSvgSanitized=p})}get id(){return this._id}get name(){return this._name}get icon(){return this._icon}get iconSvg(){return this._iconSvgSanitized}get mount(){return this._mount}get setIsActive(){return this._setIsActive||(()=>{})}get update(){return this._update}get destroy(){return this._destroy}get enabled(){return this._enabled}get scrollBottomReached(){return this._scrollBottomReached}}S.prototype.t=g,window.OCA.Files||(window.OCA.Files={}),Object.assign(window.OCA.Files,{Sidebar:new Ae}),Object.assign(window.OCA.Files.Sidebar,{Tab:$e}),window.addEventListener("DOMContentLoaded",function(){const e=document.querySelector("body > .content")||document.querySelector("body > #content");if(e&&!document.getElementById("app-sidebar")){const o=document.createElement("div");o.id="app-sidebar",e.appendChild(o)}const i=S.extend(Ee),n=new i({name:"SidebarRoot"});n.$mount("#app-sidebar"),window.OCA.Files.Sidebar.open=n.open,window.OCA.Files.Sidebar.close=n.close,window.OCA.Files.Sidebar.setFullScreenMode=n.setFullScreenMode,window.OCA.Files.Sidebar.setShowTagsDefault=n.setShowTagsDefault});
